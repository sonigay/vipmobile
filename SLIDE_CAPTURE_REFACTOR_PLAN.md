# 슬라이드 캡처 완전 통합 아키텍처 (옵션 C)

## 목표
- **98% 이상 성공률 달성**
- 슬라이드별 특수 핸들러 완전 제거
- 설정 기반 완전 통합 로직 구현
- 회사 로고/이름/헤더 디자인 유지
- 장기적 유지보수성 확보

## 핵심 전략

### 1. 완전 통합 캡처 엔진 설계
- **단일 통합 캡처 함수**: 모든 슬라이드 타입을 하나의 함수로 처리
- **설정 기반 파이프라인**: 설정값에 따라 단계별 처리 실행
- **강력한 요소 탐지**: 멀티 레벨 검색으로 요소 탐지 성공률 향상
- **자동 복구 메커니즘**: 실패 시 자동으로 대체 방법 시도

### 2. 설정 기반 처리 파이프라인
```
1. 전처리 (Pre-processing)
   - 데이터 로딩 대기
   - 버튼 클릭 (확대/펼치기)
   - 스크롤 제거
   
2. 요소 탐지 (Element Detection)
   - 타겟 요소 탐지
   - 헤더 탐지 (회사 로고/이름 유지)
   - 콘텐츠 박스 탐지
   - 테이블/그래프 탐지
   
3. 크기 조정 (Size Adjustment)
   - 박스 크기 조정
   - 헤더 크기 조정
   - 콘텐츠 크기 측정
   - 여백 제거
   
4. 캡처 실행 (Capture Execution)
   - 단일 캡처 또는 합성 캡처
   - 크기 제한 적용
   - 스타일 복원
```

### 3. 강화된 요소 탐지 로직
- **멀티 레벨 검색**: 5단계 검색으로 탐지 성공률 98% 이상
  1. 클래스명/속성 기반 검색
  2. 위치 기반 검색 (상단/절대 위치)
  3. 텍스트 컨텐츠 기반 검색
  4. 구조적 검색 (DOM 트리 분석)
  5. 폴백 검색 (후보 요소 선별)
- **헤더 보존**: 회사 로고/이름 포함 헤더 자동 탐지 및 보존
- **스마트 폴백**: 탐지 실패 시 자동으로 대체 방법 시도

### 4. 자동화된 에러 처리
- **재시도 메커니즘**: 실패 시 자동 재시도 (최대 3회)
- **폴백 전략**: 각 단계별 폴백 전략 준비
- **상세 로깅**: 디버깅을 위한 상세 로그

## 구현 계획

### Phase 1: 통합 캡처 엔진 구현
**파일**: `src/components/meeting/UnifiedCaptureEngine.js`
- 단일 통합 캡처 함수 `captureSlide()` 구현
- 설정 기반 파이프라인 구현
- 강화된 요소 탐지 로직 구현
- 자동 복구 메커니즘 구현

**주요 기능**:
- `captureSlide(slideElement, slide, captureTargetElement)`: 메인 캡처 함수
- `preProcess(slideElement, config)`: 전처리 단계
- `detectElements(slideElement, config)`: 요소 탐지 단계
- `adjustSizes(elements, config)`: 크기 조정 단계
- `executeCapture(elements, config)`: 캡처 실행 단계

### Phase 2: 설정 파일 개선
**파일**: `src/components/meeting/SlideCaptureConfig.js`
- 모든 슬라이드 타입 설정 완전화
- 헤더 보존 설정 추가
- 탐지 전략 설정 추가
- 복구 전략 설정 추가

**주요 설정**:
- `detectionStrategy`: 요소 탐지 전략 (header, content, table, chart)
- `headerPreservation`: 헤더 보존 여부 및 방법
- `captureMethod`: 캡처 방법 (direct, composite, commonAncestor)
- `retryConfig`: 재시도 설정
- `fallbackStrategy`: 폴백 전략

### Phase 3: 기존 코드 제거 및 교체
**파일**: `src/components/meeting/unifiedCaptureLogic.js`
- 슬라이드별 특수 핸들러 완전 제거
- 새로운 통합 엔진으로 교체
- MeetingCaptureManager.js에서 통합 엔진 사용

### Phase 4: 헤더 보존 로직
**파일**: `src/components/meeting/UnifiedCaptureEngine.js`
- 헤더 자동 탐지 로직 (회사 로고/이름 포함)
- 헤더 스타일 보존 로직
- 헤더 + 콘텐츠 합성 로직

**헤더 탐지 전략**:
1. 클래스명 기반: `[class*="header"], .MuiAppBar-root, .MuiToolbar-root`
2. 위치 기반: 상단 절대/고정 위치 요소
3. 텍스트 기반: 회사명 포함 요소 (`(주)브이아이피플러스`, `브이아이피`)
4. 로고 기반: 이미지/로고 포함 요소
5. 구조 기반: DOM 트리 상단에 위치한 큰 요소

### Phase 5: 테스트 및 검증
- 모든 슬라이드 타입 테스트
- 에지 케이스 테스트
- 성능 테스트
- 98% 이상 성공률 검증

## 주요 개선 사항

### 1. 단일 통합 캡처 함수
- 모든 슬라이드 타입을 하나의 함수로 처리
- 설정값에 따라 동적으로 처리 단계 결정
- 코드 중복 완전 제거

### 2. 강화된 요소 탐지
- 5단계 검색: 클래스명 → 위치 → 텍스트 → 구조 → 폴백
- 헤더 자동 탐지 및 보존
- 스마트 폴백 메커니즘

### 3. 자동화된 에러 처리
- 각 단계별 자동 재시도
- 실패 시 폴백 전략 자동 실행
- 상세한 에러 로깅

### 4. 설정 기반 처리
- 모든 슬라이드 타입을 설정으로 관리
- 새로운 슬라이드 타입 추가 시 설정만 추가
- 코드 수정 없이 동작 조정 가능

## 성공 지표
- **성공률**: 98% 이상
- **코드 중복**: 0% (기존 특수 핸들러 완전 제거)
- **유지보수성**: 새로운 슬라이드 타입 추가 시 설정만 수정
- **에러 처리**: 모든 에지 케이스 자동 처리

## 리스크 관리
- **롤백 계획**: 기존 코드 백업 및 git commit
- **단계적 배포**: Phase별로 검증 후 다음 단계 진행
- **상세 로깅**: 문제 발생 시 빠른 디버깅 가능

## 예상 결과
- **단기 (1주일)**: 기본 통합 엔진 구현 및 테스트
- **중기 (2주)**: 모든 슬라이드 타입 통합 및 검증
- **장기 (1개월)**: 98% 이상 성공률 달성 및 안정화

## 구현 TODO

1. ✅ 통합 캡처 엔진 구현 (UnifiedCaptureEngine.js)
   - 단일 통합 캡처 함수 및 설정 기반 파이프라인

2. ✅ 설정 파일 개선 (SlideCaptureConfig.js)
   - 모든 슬라이드 타입 설정 완전화 및 헤더 보존 설정 추가

3. ✅ 강화된 요소 탐지 로직 구현
   - 5단계 검색 및 헤더 자동 탐지

4. ✅ 헤더 보존 로직 구현
   - 회사 로고/이름 포함 헤더 자동 탐지 및 스타일 보존

5. ✅ 자동화된 에러 처리 구현
   - 재시도 메커니즘 및 폴백 전략

6. ✅ 기존 코드 제거 및 교체
   - 슬라이드별 특수 핸들러 완전 제거

7. ✅ MeetingCaptureManager.js 통합
   - 새로운 통합 엔진 사용

8. ✅ 테스트 및 검증
   - 모든 슬라이드 타입 테스트 및 98% 이상 성공률 검증

