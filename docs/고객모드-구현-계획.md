# 고객모드 구현 계획

## 개요
직영점 모드와 별도로 고객이 직접 사용할 수 있는 고객모드를 구현합니다.

---

## 라우팅 구조

### 현재 상태
- ✅ `/member` 경로는 **사용 가능** (현재 사용되지 않음)
- 현재 프로젝트는 React Router를 사용하지 않음
- URL 쿼리 파라미터 방식 사용 중 (`?activationSheetId=...`)

### 구현 방안

**React Router 도입 (확정) ⭐**

**선택 이유:**

1. **확장성 및 유지보수성**
   - 고객모드가 성장하면서 여러 하위 페이지가 필요할 수 있음 (`/member/dashboard`, `/member/orders`, `/member/settings` 등)
   - React Router는 중첩 라우팅, 동적 라우팅을 쉽게 지원
   - 경로별 컴포넌트 분리가 명확하여 코드 구조가 깔끔해짐

2. **URL 관리의 일관성**
   - 브라우저 뒤로가기/앞으로가기 버튼이 자연스럽게 작동
   - URL 공유 시 정확한 페이지로 이동 가능
   - 브라우저 히스토리 API와 완벽하게 통합

3. **SEO 및 접근성**
   - 각 경로가 독립적인 URL을 가져 검색 엔진 최적화에 유리
   - 북마크 가능한 URL 제공
   - 스크린 리더 등 접근성 도구와 호환성 향상

4. **개발자 경험 (DX)**
   - React 생태계의 표준 라우팅 솔루션
   - 풍부한 문서와 커뮤니티 지원
   - `useNavigate`, `useParams`, `useLocation` 등 편리한 훅 제공
   - 라우트 가드, 레이지 로딩 등 고급 기능 지원

5. **성능 최적화**
   - 코드 스플리팅과 레이지 로딩을 쉽게 구현 가능
   - 필요한 페이지만 로드하여 초기 로딩 시간 단축
   - React.lazy()와 Suspense와 함께 사용 가능

6. **기존 코드와의 호환성**
   - 기존 일반모드/관리자모드는 루트(`/`) 경로 유지 가능
   - 점진적 도입 가능 (기존 코드 수정 최소화)
   - 조건부 렌더링 로직을 라우팅으로 분리하여 코드 복잡도 감소

7. **향후 확장성**
   - API 라우팅과의 일관성 유지
   - 서버 사이드 렌더링(SSR)으로 전환 시 Next.js 등과 호환 용이
   - 마이크로 프론트엔드 아키텍처로 확장 시 유리

**구현 내용:**
- `react-router-dom` 패키지 추가
- `/member` 경로로 고객모드 접근
- 기존 일반모드/관리자모드는 루트(`/`) 경로 유지
- 중첩 라우팅 구조로 확장 가능

### 경로 구조
```
/                    → 일반모드/관리자모드 로그인 (기존)
/member              → 고객모드 로그인 (신규)
/member/dashboard    → 고객 대시보드 (신규) - 직영점모드 휴대폰목록 페이지 렌더링
```

---

## 요구사항 및 기능

### 1. 기본 구조
- [x] `/member` 경로 라우팅 구현
- [x] 고객모드 전용 로그인 화면
- [x] 고객 인증/로그인 시스템
- [x] 고객 대시보드/홈 화면
  - **직영점모드의 휴대폰목록 페이지 렌더링** (로그인 후 메인 화면)

### 2. 주요 기능

#### 2.1 로그인 시스템
- [x] **로그인 인증 방식**
  - 아이디: `직영점_판매일보` 시트의 `CTN` 컬럼 값에서 하이픈(`-`) 제거
  - 비밀번호: CTN 번호에서 `010` 뒤로 오는 4자리
  - 예시: CTN이 `010-1234-5678`인 경우
    - 아이디: `01012345678`
    - 비밀번호: `1234` (010 뒤로 오는 4자리)
  - 예시: CTN이 `01012345678`인 경우
    - 아이디: `01012345678`
    - 비밀번호: `1234` (010 뒤로 오는 4자리)

#### 2.1.1 고객모드 로그인 화면 디자인
- [x] **회사 로고**
  - 브이아이피플러스 회사 로고 표시
  - 로고와 잘 어울리는 세련된 디자인
- [x] **로그인 폼**
  - 아이디 입력 필드
  - 비밀번호 입력 필드
  - 로그인 버튼
- [x] **홍보 문구 영역**
  - 다음 문구들을 멋지게 표현:
    - "호갱걱정 NO"
    - "사후관리걱정 NO"
    - "실시간으로 공개되는 투명한 정찰제 가격"
    - "임직원 30명"
    - "당사 거래 파트너점 25년12월기준 480여 업체"
    - "16년 이상의 업력에서 나오는 안정적 재무 구조의 검증된 기업"
    - "휴대폰 구매! 앞으로 브이아이피플러스와 함께하세요"
- [x] **제외 항목**
  - 확장프로그램 여부 선택 불필요
  - 파트너사 선택 불필요

#### 2.2 메인 화면 탭 구조
고객모드 접속 시 3개의 탭으로 구성:
- [x] **휴대폰시세표 탭** (직영점모드에서는 "휴대폰목록" 탭)
  - 직영점모드의 휴대폰목록 페이지와 동일한 화면
  - **동일한 컴포넌트 재사용**: `MobileListTab` 컴포넌트
  - **동일한 API 호출**: 같은 데이터 소스 사용
  - **자동 동기화**: 직영점모드에서 수정 시 서버 캐시 무효화로 다음 요청 시 최신 데이터 반영 (최대 5분 지연 가능)
  - **수정 기능 없음**: 읽기 전용 (이미지 업로드, 태그 수정 불가)
  - 상품 테이블에서 상품 선택 시:
    - 매장 미선택 상태: 안내 페이지 → 선호구입매장 탭으로 이동
    - 매장 선택 완료 상태: 안내 페이지 → 개통정보 입력 페이지로 이동
- [x] **선호구입매장 탭**
  - 지도 화면을 통한 매장 선택 기능
  - VIP직영 매장만 표시 (폰클출고처데이터 시트 18번 인덱스 필터링)
  - 매장 선택 시:
    - 상품 미선택 상태: 안내 페이지 → 휴대폰시세표 탭으로 이동
    - 상품 선택 완료 상태: 안내 페이지 → 개통정보 입력 페이지로 이동
- [x] **구매대기 탭**
  - 판매일보와 같은 형식의 테이블
  - 로그인한 고객의 CTN(아이디)로 저장된 구매대기만 표시
  - 개통정보 입력 완료 후 선택한 매장 정보와 함께 저장된 목록 표시
  - 행 선택 시 해당 구매대기 정보 불러오기 (판매일보와 동일한 방식)
  - 선택한 정보 수정/삭제 기능 (본인의 구매대기만 수정/삭제 가능)
  - 선호매장(선택매장)만 수정 가능한 기능

#### 2.3 개통정보 입력 플로우

**플로우 1: 휴대폰시세표에서 먼저 상품 선택**
1. 휴대폰시세표 탭에서 상품 선택
2. 안내 페이지 표시: "선호매장을 선택해주세요"
3. 선호구입매장 탭으로 자동 이동
4. 지도에서 매장 선택
5. 안내 페이지 표시: "이제 개통정보 입력을 통해 구입을 예약해주세요. 입력된 정보는 수정 및 삭제가 직접 가능합니다."
6. 개통정보 입력 페이지로 이동
7. 개통정보 입력 완료 후 → 구매대기 탭으로 이동

**플로우 2: 선호구입매장에서 먼저 매장 선택**
1. 선호구입매장 탭에서 매장 선택
2. 안내 페이지 표시: "휴대폰시세표 탭을 통해 구입하실 휴대폰을 선택합니다"
3. 휴대폰시세표 탭으로 자동 이동
4. 상품 테이블에서 상품 선택
5. 안내 페이지 표시: "이제 개통정보 입력을 통해 구입을 예약해주세요. 입력된 정보는 수정 및 삭제가 직접 가능합니다."
6. 개통정보 입력 페이지로 이동
7. 개통정보 입력 완료 후 → 구매대기 탭으로 이동

**안내 페이지 구성**
- [x] **상품 선택 후 안내 페이지**
  - 메시지: "선호매장을 선택해주세요"
  - 선호구입매장 탭으로 이동 버튼
- [x] **매장 선택 후 안내 페이지**
  - 메시지: "휴대폰시세표 탭을 통해 구입하실 휴대폰을 선택합니다"
  - 휴대폰시세표 탭으로 이동 버튼
- [x] **모든 선택 완료 후 안내 페이지**
  - 메시지: "이제 개통정보 입력을 통해 구입을 예약해주세요. 입력된 정보는 수정 및 삭제가 직접 가능합니다."
  - 개통정보 입력 페이지로 이동 버튼

#### 2.3.1 개통정보 입력 페이지 매장 정보 표시
**직영점모드와 고객모드 모두 적용:**
- [x] **매장 정보 표시 영역**
  - 업체명 표시
  - 연락처 표시
  - 주소 표시
  - 계좌정보 표시 (`폰클출고처데이터` 시트 35번 인덱스)
  - 사전승낙서 마크 표시
- [x] **인쇄 시 매장 정보 포함**
  - 인쇄 미리보기 및 실제 인쇄 시에도 매장 정보 표시
  - 업체명, 연락처, 주소, 계좌정보, 사전승낙서 마크 모두 포함
- [x] **데이터 소스**
  - 직영점모드: `loggedInStore` prop으로 전달된 로그인한 매장 정보 사용
  - 고객모드: `selectedStore` prop으로 전달된 선호구입매장 탭에서 선택한 매장 정보 사용

#### 2.3.2 고객모드 개통정보 입력 페이지 안내문구
**고객모드 전용 안내문구:**
- [x] **안내문구 추가**
  - "대기자가 많을수 있으니 빠른 개통업무를 위해 입력된정보를 인쇄해서 방문해주세요"
  - "휴대폰정책상 매일 매시간 정책변동이 있을수 있어 개통방문시 개통순간 가격을 확인해주세요"
- [x] **표시 위치**
  - 기존 안내문구 영역에 추가 또는 별도 안내문구 영역 생성
- [x] **인쇄 시 포함**
  - 인쇄 미리보기 및 실제 인쇄 시에도 안내문구 포함

#### 2.4 선호구입매장 탭 (지도 화면)
- [x] **지도 컴포넌트**
  - 관리자모드에서 사용되는 지도 컴포넌트 재사용
- [x] **매장 필터링**
  - `폰클출고처데이터` 시트의 18번 인덱스(열) 값이 `"VIP직영"`인 매장만 지도에 표시
- [x] **마커 정보 표시**
  - 마커 클릭 시 다음 정보 표시:
    - 14번 인덱스: 업체명
    - 19번 인덱스: 전화
    - 22번 인덱스: 휴대폰
    - 28번 인덱스: 사업자번호
    - 29번 인덱스: 점장명
    - 32번 인덱스: 매장주소
    - 업로드된 매장 사진 (전면, 내부, 외부, 외부2)
    - 업로드된 점장 및 직원 사진 (점장, 직원1, 직원2, 직원3)
  - 말풍선(인포윈도우) 형태로도 정보 표시
- [x] **사전승낙서마크 기능**
  - 업체명 상단에 사전승낙서마크 입력 필드 - **별도 관리 페이지 필요 (직영점모드/관리모드)**
  - 입력 형식: `<a href="https://ictmarket.or.kr:8443/precon/pop_CertIcon.do?PRECON_REQ_ID=PRE0000136285" target="_blank"><img style="cursor:pointer;" src="https://ictmarket.or.kr:8443/getCertIcon.do?cert_icon=KL20060528930E004"></a>`
  - 저장하기 버튼으로 구글시트에 저장 - **API 구현 완료**
  - 저장된 주소로 사전승낙서마크 이미지 표시 - **고객모드 팝업 및 개통정보 입력 페이지에 표시 완료**
  - **권한**: 직영점모드/직영점관리모드에서만 수정 가능, 고객모드에서는 표시만
- [x] **매장 사진 업로드 기능**
  - 매장별 사진 업로드 (4개) - **별도 관리 페이지 필요 (직영점모드/관리모드)**
    - 전면 사진
    - 내부 사진
    - 외부 사진
    - 외부2 사진
  - 점장 및 직원 사진 업로드 (4명) - **별도 관리 페이지 필요 (직영점모드/관리모드)**
    - 점장 사진
    - 직원1 사진
    - 직원2 사진
    - 직원3 사진
  - Google Drive API를 통한 이미지 파일 저장 (Discord 사용 안 함, URL 만료 문제 해결) - **파일 업로드 API 구현 완료**
  - 업로드된 이미지 URL을 구글시트에 저장 - **API 구현 완료**
  - 마커 클릭 시 업로드된 사진들 노출 - **고객모드 팝업에 표시 완료**
  - **권한**: 직영점모드/직영점관리모드에서만 수정 가능, 고객모드에서는 표시만
- [x] **매장 선택 버튼**
  - 마커 또는 매장 정보 영역에 "해당매장선택하기" 버튼
  - 버튼 클릭 시:
    - 상품 미선택 상태: 안내 페이지 → 휴대폰시세표 탭으로 이동
    - 상품 선택 완료 상태: 안내 페이지 → 개통정보 입력 페이지로 이동
- [x] **선택 상태 관리**
  - 선택한 매장 정보를 localStorage에 저장 (새로고침 후에도 유지)
  - 개통정보 입력 페이지에서 사용할 수 있도록 전달

#### 2.5 구매대기 페이지
- [x] **테이블 구조**
  - 판매일보와 동일한 형식의 테이블
  - **개인정보 마스킹 처리**:
    - 고객모드/직영점모드: 고객명 앞글자와 맨뒷글자만 표시, 가운데는 `***`로 마스킹
    - 고객모드/직영점모드: 개통번호(CTN) 가운데 번호는 `****`로 마스킹
    - 직영점관리모드: 모든 정보 표시 (마스킹 없음)
  - **마진 컬럼 제외**: 구매대기 테이블에는 마진 관련 컬럼 표시하지 않음
- [x] **데이터 저장**
  - 개통정보 입력 내용
  - 선택한 매장 정보
  - 위 정보를 테이블 목록에 저장
- [x] **행 선택 기능**
  - 테이블 행 클릭 시 해당 구매대기 정보 불러오기
  - 판매일보의 행 선택 기능과 동일한 방식
- [x] **정보 수정 기능**
  - 선택한 구매대기 정보 수정 가능
  - 개통정보 입력 페이지와 유사한 수정 화면
  - 수정 후 저장 시 `직영점_구매대기` 시트 업데이트
- [x] **정보 삭제 기능**
  - 선택한 구매대기 정보 삭제 가능
  - 삭제 확인 후 `직영점_구매대기` 시트에서 해당 행 제거
- [x] **선호매장 수정 기능**
  - 선택한 구매대기 정보에서 선호매장(선택매장)만 별도로 수정 가능
  - 지도 화면으로 이동하여 다른 매장 선택 가능
  - 매장 변경 시 `직영점_구매대기` 시트의 U~X열(선택매장 정보)만 업데이트

#### 2.6 직영점모드/직영점관리모드 구매대기 탭
- [x] **직영점모드 구매대기 탭**
  - 해당 매장으로 선택된 구매대기 데이터만 표시
  - `폰클출고처데이터` 시트의 15번 인덱스(POS코드)로 필터링
  - 해당 매장의 구매대기 고객만 필터링하여 보여줌
  - **개인정보 마스킹 처리**: 고객명과 개통번호 마스킹 적용
  - 행 선택 시 정보 불러오기 기능 (고객모드와 동일)
  - 정보 수정/삭제 기능 (고객모드와 동일)
  - 선호매장 수정 기능 (고객모드와 동일)
- [x] **직영점관리모드 구매대기 탭**
  - 모든 구매대기 정보를 모두 표시
  - 전체 매장의 구매대기 데이터 조회
  - **개인정보 표시**: 모든 정보 표시 (마스킹 없음)
  - 행 선택 시 정보 불러오기 기능 (고객모드와 동일)
  - 정보 수정/삭제 기능 (고객모드와 동일)
  - 선호매장 수정 기능 (고객모드와 동일)

### 3. 데이터 관리
- [x] **로그인 데이터**
  - `직영점_판매일보` 시트의 `CTN` 컬럼 활용
- [x] **매장 데이터**
  - `폰클출고처데이터` 시트 활용
  - 18번 인덱스 = "VIP직영" 필터링
- [x] **사전승낙서마크 데이터**
  - `직영점_사전승낙서마크` 시트에 저장
- [x] **매장 사진 데이터**
  - `직영점_매장사진` 시트에 저장
  - 매장별 사진 URL 저장 (전면, 내부, 외부, 외부2)
  - 점장 및 직원 사진 URL 저장 (점장, 직원1, 직원2, 직원3)
  - Google Drive API를 통한 이미지 파일 저장 (Discord 사용 안 함, 안정적인 URL 제공) - 파일 업로드 API 구현 완료
- [x] **구매대기 데이터**
  - `직영점_구매대기` 시트에 저장
  - 선택한 매장 정보 포함하여 저장
  - 직영점모드: 해당 매장으로 필터링
  - 직영점관리모드: 전체 데이터 조회
- [x] **선택 상태 관리**
  - 선택한 상품 정보 (localStorage에 저장, 새로고침 후에도 유지)
  - 선택한 매장 정보 (localStorage에 저장, 새로고침 후에도 유지)
  - 개통정보 입력 페이지로 전달
  - 개통정보 입력 완료 후에도 유지 (다음 구매를 위해)

### 4. UI/UX
- [x] **고객모드 로그인 화면 디자인**
  - 브이아이피플러스 회사 로고 표시
  - 세련되고 현대적인 디자인
  - 홍보 문구 영역 레이아웃
  - 로그인 폼 디자인 (아이디/비밀번호 입력 필드, 로그인 버튼)
- [x] 지도 마커 클릭 시 말풍선(인포윈도우) 표시
- [x] 매장 정보 카드/패널 디자인
- [x] 사전승낙서마크 이미지 표시 영역
- [x] 매장 사진 갤러리 UI (전면, 내부, 외부, 외부2)
- [x] 점장 및 직원 사진 갤러리 UI (점장, 직원1, 직원2, 직원3)
- [x] 구매대기 테이블 UI (판매일보와 동일한 스타일)
- [x] 개통정보 입력 페이지 매장 정보 표시 영역
  - 업체명, 연락처, 주소, 계좌정보, 사전승낙서 마크 레이아웃
  - 인쇄 시 매장 정보 포함 레이아웃
- [x] 안내 페이지 UI 디자인
  - 각 플로우별 안내 메시지 표시
  - 탭 이동 버튼 디자인
  - 뒤로가기 버튼 (이전 페이지로 이동)

---

## 기술 스택
- React (기존 프로젝트와 동일)
- Material-UI (기존 프로젝트와 동일)
- **React Router DOM** (신규 추가)
- 기존 API 구조 활용

---

## 구현 단계

### Phase 1: React Router 도입 및 기본 구조 설정
1. [x] React Router 도입 결정
2. [x] `react-router-dom` 패키지 설치
3. [x] App.js에 BrowserRouter 래핑
4. [x] 기본 라우팅 구조 설정
   - `/` → 기존 일반모드/관리자모드 (기존 코드 유지)
   - `/member` → 고객모드 로그인 화면
   - `/member/*` → 고객모드 하위 경로들

### Phase 2: 고객모드 로그인 시스템
1. [x] 고객모드 전용 로그인 컴포넌트 생성
   - 브이아이피플러스 회사 로고 포함
   - 세련된 디자인 적용
   - 홍보 문구 영역 구현
2. [x] 고객 인증 로직 구현
   - `직영점_판매일보` 시트의 CTN 컬럼 조회
   - 하이픈 제거된 CTN = 아이디
   - CTN 가운데 4자리 = 비밀번호
3. [x] 로그인 상태 관리 (localStorage 사용)
4. [x] 로그인 API 연동

### Phase 3: 고객 대시보드 및 기능 구현
1. [x] 고객 대시보드 레이아웃
   - 직영점모드 휴대폰목록 페이지 컴포넌트 재사용 또는 통합
   - 3개 탭 구조 구현 (휴대폰시세표, 선호구입매장, 구매대기)
   - 선택 상태 관리 (선택한 상품, 선택한 매장)
2. [x] 안내 페이지 컴포넌트 구현
   - 상품 선택 후 안내 페이지 ("선호매장을 선택해주세요")
   - 매장 선택 후 안내 페이지 ("휴대폰시세표 탭을 통해 구입하실 휴대폰을 선택합니다")
   - 모든 선택 완료 후 안내 페이지 ("이제 개통정보 입력을 통해 구입을 예약해주세요. 입력된 정보는 수정 및 삭제가 직접 가능합니다.")
3. [x] 휴대폰시세표 탭
   - `MobileListTab` 컴포넌트 재사용 (직영점모드와 동일)
   - 동일한 API 호출로 같은 데이터 소스 사용
   - 수정 기능 제거 (이미지 업로드, 태그 수정 버튼 숨김 또는 비활성화)
   - 상품 선택 시 상태 저장
   - 매장 미선택 상태: 안내 페이지 → 선호구입매장 탭으로 이동
   - 매장 선택 완료 상태: 안내 페이지 → 개통정보 입력 페이지로 이동
   - **동기화**: 직영점모드에서 수정 시 서버 캐시 무효화로 자동 동기화 (최대 5분 지연)
4. [x] 선호구입매장 탭 (지도 화면)
   - [x] 관리자모드 지도 컴포넌트 재사용
   - [x] `폰클출고처데이터` 시트에서 VIP직영 매장 필터링
   - [x] 마커 표시 및 클릭 이벤트
   - [x] 매장 정보 표시 (14, 19, 22, 28, 29, 32 인덱스) - 고객모드 팝업에 표시 완료
   - [x] 말풍선(인포윈도우) 구현 - 고객모드 팝업 구현 완료
   - [x] 사전승낙서마크 기능
     - [x] 입력 필드 및 저장 버튼 (직영점모드/직영점관리모드에서만 수정 가능) - 별도 관리 페이지 완료
     - [x] 구글시트 저장 API 연동
     - [x] 마크 이미지 표시 (고객모드 팝업에 표시 완료, 개통정보 입력 페이지에도 표시 완료)
   - [x] 매장 사진 업로드 기능
     - [x] 매장 사진 업로드 (전면, 내부, 외부, 외부2) - 4개 (직영점모드/직영점관리모드에서만 수정 가능) - 별도 관리 페이지 완료
     - [x] 점장 및 직원 사진 업로드 (점장, 직원1, 직원2, 직원3) - 4명 (직영점모드/직영점관리모드에서만 수정 가능) - 별도 관리 페이지 완료
     - [x] Google Drive API를 통한 이미지 파일 저장 (Discord 사용 안 함, 안정적인 URL 제공) - 파일 업로드 API 구현 완료
     - [x] 업로드된 이미지 URL을 구글시트에 저장
     - [x] 마커 클릭 시 업로드된 사진들 노출 (고객모드 팝업에 표시 완료)
     - [x] 고객모드에서는 표시만 (수정 불가)
   - [x] 매장 선택 시 상태 저장
   - [x] 상품 미선택 상태: 안내 페이지 → 휴대폰시세표 탭으로 이동
   - [x] 상품 선택 완료 상태: 안내 페이지 → 개통정보 입력 페이지로 이동
5. [x] 개통정보 입력 페이지
   - [x] 직영점모드와 동일한 컴포넌트 재사용
   - [x] **Props로 모드 구분**:
     - `mode`: "customer" | "directStore" | "management" (기본값: "directStore")
     - `customerInfo`: 고객모드일 때 로그인한 고객 정보 (CTN 등)
     - `selectedStore`: 고객모드일 때 선택한 매장 정보
     - `loggedInStore`: 직영점모드일 때 로그인한 매장 정보 (기존)
     - `saveToSheet`: "purchaseQueue" | "salesReport" (저장 대상 시트 구분)
   - [x] 선택한 상품 정보와 선택한 매장 정보를 초기값으로 설정
   - [x] 매장 정보 표시 기능 추가
     - [x] 업체명, 연락처, 주소, 계좌정보 표시
     - [x] 사전승낙서 마크 표시 (API 연동 완료)
     - [x] 인쇄 시에도 매장 정보 포함
     - [x] 고객모드: `selectedStore` prop 사용
     - [x] 직영점모드: `loggedInStore` prop 사용
   - [x] 고객모드 전용 안내문구 추가 (`mode === "customer"`일 때만 표시)
     - [x] "대기자가 많을수 있으니 빠른 개통업무를 위해 입력된정보를 인쇄해서 방문해주세요"
     - [x] "휴대폰정책상 매일 매시간 정책변동이 있을수 있어 개통방문시 개통순간 가격을 확인해주세요"
     - [x] 인쇄 시에도 안내문구 포함
   - [x] 입력 완료 시 저장 대상 구분
     - [x] 고객모드: `직영점_구매대기` 시트에 저장
     - [x] 직영점모드: `직영점_판매일보` 시트에 저장
   - [x] 입력 완료 시 구매대기 탭으로 이동 (고객모드만)
6. [x] 구매대기 탭
   - [x] 판매일보 형식의 테이블 구현
   - [x] 개통정보 + 선택매장 정보 저장
   - [x] 고객모드: 로그인한 CTN(아이디)로 저장된 구매대기만 조회 및 표시
   - [x] 개인정보 마스킹 처리 구현 (고객모드/직영점모드: 고객명, 개통번호 마스킹)
   - [x] 마진 컬럼 제외 (테이블에 표시하지 않음)
   - [x] 행 선택 시 정보 불러오기 기능 구현
   - [x] 정보 수정 기능 구현 (개통정보 입력 페이지 재사용 또는 수정 화면)
     - [x] 고객모드: 본인의 구매대기만 수정 가능
     - [x] 직영점모드: 해당 매장의 구매대기만 수정 가능
     - [x] 직영점관리모드: 모든 구매대기 수정 가능
   - [x] 정보 삭제 기능 구현
     - [x] 고객모드: 본인의 구매대기만 삭제 가능
     - [x] 직영점모드: 해당 매장의 구매대기만 삭제 가능
     - [x] 직영점관리모드: 모든 구매대기 삭제 가능
   - [x] 선호매장 수정 기능 구현 (지도 화면으로 이동하여 매장 재선택)
   - [x] 뒤로가기 기능 구현 (모든 페이지에 적용)
8. [x] 직영점모드/직영점관리모드 구매대기 탭 추가
   - [x] 직영점모드: `선택매장업체명`으로 `폰클출고처데이터` 시트에서 POS코드 조회 후, 로그인한 매장의 POS코드와 매칭하여 필터링
   - [x] 직영점관리모드: 전체 구매대기 데이터 표시
   - [x] 구매대기 데이터 필터링 로직 구현
   - [x] 개인정보 마스킹 처리 (직영점모드만, 직영점관리모드는 마스킹 없음)
   - [x] 행 선택 시 정보 불러오기 기능 구현
   - [x] 정보 수정/삭제 기능 구현
   - [x] 선호매장 수정 기능 구현

### Phase 4: API 구현
1. [x] 구매대기 API 구현
   - [x] 판매일보 API 패턴 재사용 (헤더 보정, 데이터 변환, 행 생성/업데이트 로직)
   - [x] **별도 헤더 정의**: `PURCHASE_QUEUE_HEADERS` (A~AB 열, 마진 컬럼 제외)
   - [x] `GET /api/member/queue/all` - 조회 (필터링: CTN, POS코드)
   - [x] `GET /api/member/queue` - 조회 (CTN 필터링)
   - [x] `POST /api/member/queue` - 생성
   - [x] `PUT /api/member/queue/:id` - 수정
   - [x] `DELETE /api/member/queue/:id` - 삭제
   - [x] `fetchSheetValuesDirectly`, `rateLimitedSheetsCall` 재사용
   - [x] **주의**: 판매일보는 마진 컬럼 있음(U열), 구매대기는 마진 컬럼 없음 (구조 다름)
2. [x] 사전승낙서마크 API 구현
   - [x] `GET /api/direct/pre-approval-mark/:storeName` - 조회
   - [x] `POST /api/direct/pre-approval-mark` - 저장/업데이트
   - [x] `fetchSheetValuesDirectly` 재사용
3. [x] 매장 사진 API 구현
   - [x] `GET /api/direct/store-image/:storeName` - 조회
   - [x] `POST /api/direct/store-image` - URL 저장 (구글시트에 저장)
   - [x] `POST /api/direct/store-image/upload` - 파일 업로드
     - [x] Google Drive API를 통한 이미지 파일 저장 (Discord 사용 안 함)
     - [x] 안정적인 이미지 URL 제공 (만료 없음)
   - [x] 파일 업로드 처리 로직만 재사용 (multer 등)
4. [x] 고객 로그인 API 구현
   - [x] `POST /api/member/login` - 로그인 인증
   - [x] `fetchSheetValuesDirectly('직영점_판매일보')` 재사용

### Phase 5: 테스트 및 최적화
1. [ ] 라우팅 테스트
2. [ ] 성능 최적화 (코드 스플리팅, 캐싱 확인)
3. [ ] 에러 핸들링
4. [ ] API 성능 테스트 (캐싱 효과 확인)

---

## 부록

### 부록 A: 필요 시트 및 헤더 정의

#### 복사 붙여넣기용 시트 헤더

##### 1. 직영점_구매대기 시트

**시트명**: `직영점_구매대기`

**A1~AB1 헤더 (복사용)**:
```
번호	고객CTN	고객명	통신사	단말기모델명	색상	단말일련번호	유심모델명	유심일련번호	개통유형	전통신사	할부구분	할부개월	약정	요금제	부가서비스	출고가	이통사지원금	대리점추가지원금(부가유치)	대리점추가지원금(부가미유치)	선택매장업체명	선택매장전화	선택매장주소	선택매장계좌정보	등록일시	상태	처리매장업체명	처리일시
```

**컬럼 설명**:
- **A열 (번호)**: 내부 ID, `pending-{timestamp}` 형식
- **B열 (고객CTN)**: 고객 전화번호 (하이픈 포함, 로그인 아이디로 사용)
- **C열 (고객명)**: 고객 이름
- **D열 (통신사)**: SK / KT / LG
- **E열 (단말기모델명)**: 선택한 휴대폰 모델명
- **F열 (색상)**: 선택한 색상
- **G열 (단말일련번호)**: 단말기 일련번호
- **H열 (유심모델명)**: USIM 모델명
- **I열 (유심일련번호)**: USIM 일련번호
- **J열 (개통유형)**: 신규 / 번호이동 / 기기변경
- **K열 (전통신사)**: 번호이동 시 이전 통신사
- **L열 (할부구분)**: 할부 / 현금
- **M열 (할부개월)**: 24 / 30 / 36 / 0(일시불)
- **N열 (약정)**: 일반약정 / 선택약정
- **O열 (요금제)**: 선택한 요금제명
- **P열 (부가서비스)**: 선택한 부가서비스 목록 (CSV 형식)
- **Q열 (출고가)**: 단말기 출고가
- **R열 (이통사지원금)**: 이통사 지원금
- **S열 (대리점추가지원금(부가유치))**: 부가유치 시 대리점 지원금
- **T열 (대리점추가지원금(부가미유치))**: 부가미유치 시 대리점 지원금
- **U열 (선택매장업체명)**: 고객이 선택한 매장의 업체명 (필터링용)
- **V열 (선택매장전화)**: 선택한 매장의 전화번호
- **W열 (선택매장주소)**: 선택한 매장의 주소
- **X열 (선택매장계좌정보)**: 선택한 매장의 계좌정보
- **Y열 (등록일시)**: 구매대기 등록 시점 (YYYY-MM-DD HH:mm:ss)
- **Z열 (상태)**: 구매대기 / 처리완료
- **AA열 (처리매장업체명)**: 처리한 매장의 업체명 (처리 시 입력)
- **AB열 (처리일시)**: 처리 완료 시점 (YYYY-MM-DD HH:mm:ss)

##### 2. 직영점_사전승낙서마크 시트

**시트명**: `직영점_사전승낙서마크`

**A1~C1 헤더 (복사용)**:
```
업체명	사전승낙서마크URL	수정일시
```

**컬럼 설명**:
- **A열 (업체명)**: 매장 업체명 (폰클출고처데이터 시트의 14번 인덱스와 매칭)
- **B열 (사전승낙서마크URL)**: HTML 링크 태그 전체 (`<a href="..." target="_blank"><img ...></a>`)
- **C열 (수정일시)**: 저장/수정 시점 (YYYY-MM-DD HH:mm:ss)

##### 3. 직영점_매장사진 시트

**시트명**: `직영점_매장사진`

**A1~J1 헤더 (복사용)**:
```
업체명	전면사진URL	내부사진URL	외부사진URL	외부2사진URL	점장사진URL	직원1사진URL	직원2사진URL	직원3사진URL	수정일시
```

**컬럼 설명**:
- **A열 (업체명)**: 매장 업체명 (폰클출고처데이터 시트의 14번 인덱스와 매칭)
- **B열 (전면사진URL)**: 매장 전면 사진 URL (서버에 저장된 이미지 URL)
- **C열 (내부사진URL)**: 매장 내부 사진 URL
- **D열 (외부사진URL)**: 매장 외부 사진 URL
- **E열 (외부2사진URL)**: 매장 외부2 사진 URL
- **F열 (점장사진URL)**: 점장 사진 URL
- **G열 (직원1사진URL)**: 직원1 사진 URL
- **H열 (직원2사진URL)**: 직원2 사진 URL
- **I열 (직원3사진URL)**: 직원3 사진 URL
- **J열 (수정일시)**: 저장/수정 시점 (YYYY-MM-DD HH:mm:ss)

#### 시트 생성 가이드

1. **직영점_구매대기 시트 생성**
   - 구글시트에서 새 시트 생성
   - 시트명: `직영점_구매대기`
   - A1셀부터 위의 헤더를 복사 붙여넣기

2. **직영점_사전승낙서마크 시트 생성**
   - 구글시트에서 새 시트 생성
   - 시트명: `직영점_사전승낙서마크`
   - A1셀부터 위의 헤더를 복사 붙여넣기

3. **직영점_매장사진 시트 생성**
   - 구글시트에서 새 시트 생성
   - 시트명: `직영점_매장사진`
   - A1셀부터 위의 헤더를 복사 붙여넣기

---

### 부록 B: 기존 API 재사용 분석

#### 재사용 가능한 기존 API 및 함수

##### 1. 판매일보 API 패턴 (재사용 권장 ⭐⭐⭐)

**위치**: `server/index.js` (라인 3947-4249)

**API 엔드포인트**:
- `GET /api/direct/sales` - 판매일보 조회
- `POST /api/direct/sales` - 판매일보 생성
- `PUT /api/direct/sales/:id` - 판매일보 수정

**재사용 가능한 부분**:
1. **헤더 보정 로직**: 시트 헤더 자동 보정 (A~Z 열)
2. **데이터 변환 로직**: 영문 → 한글 변환 (개통유형, 약정 등)
3. **행 생성 패턴**: 배열로 행 데이터 구성 후 append
4. **행 찾기 및 업데이트 패턴**: ID로 행 찾아서 업데이트

**구매대기 API에 적용**:
- `GET /api/direct/purchase-queue` - 구매대기 조회 (판매일보 GET 패턴 재사용)
- `POST /api/direct/purchase-queue` - 구매대기 생성 (판매일보 POST 패턴 재사용)
- `PUT /api/direct/purchase-queue/:id` - 구매대기 수정 (판매일보 PUT 패턴 재사용)
- `DELETE /api/direct/purchase-queue/:id` - 구매대기 삭제 (새로 구현 필요)

**주의사항**:
- 판매일보: 마진 컬럼 있음 (U열, A~Z 열)
- 구매대기: 마진 컬럼 없음 (A~AB 열, 마진 제외)
- **헤더는 별도 정의 필요**: `PURCHASE_QUEUE_HEADERS` (판매일보와 다른 구조)
- 패턴(헤더 보정, 데이터 변환, 행 생성/업데이트 로직)만 재사용

**성능 영향**: ✅ **매우 긍정적**
- 헤더 보정 로직 재사용으로 코드 중복 제거
- 동일한 Google Sheets API 호출 패턴으로 일관성 유지
- `rateLimitedSheetsCall` 재사용으로 API 호출 제한 관리

##### 2. Google Sheets 공통 함수 (재사용 필수 ⭐⭐⭐)

**위치**: `server/index.js` (라인 1096-1220), `server/directRoutes.js` (라인 1252-1269)

**함수들**:
- `fetchSheetValuesDirectly(sheetName, spreadsheetId)` - 시트 데이터 읽기
- `rateLimitedSheetsCall(apiCall)` - API 호출 제한 관리
- `getSheetData(sheetId, range, ttlMs)` - 캐시 적용된 시트 데이터 읽기

**재사용 가능한 부분**:
1. **캐싱 시스템**: 5분 TTL 캐시 (중복 요청 방지)
2. **Rate Limiting**: Google Sheets API 호출 제한 관리 (분당 45회)
3. **동시 요청 제한**: 최대 10개 동시 요청
4. **재시도 로직**: 429 에러 시 자동 재시도

**고객모드에서 사용**:
- `직영점_판매일보` 시트 조회 (로그인 인증)
- `폰클출고처데이터` 시트 조회 (매장 정보)
- `직영점_구매대기` 시트 조회/저장/수정/삭제
- `직영점_사전승낙서마크` 시트 조회/저장
- `직영점_매장사진` 시트 조회/저장

**성능 영향**: ✅✅✅ **매우 매우 긍정적**
- 캐싱으로 동일 시트 중복 조회 방지 (5분간 캐시 유지)
- Rate limiting으로 Google Sheets API 할당량 초과 방지
- 동시 요청 제한으로 서버 부하 관리
- 재시도 로직으로 일시적 오류 자동 복구
- **예상 성능 향상**: API 호출 수 50-70% 감소 (캐싱 효과)

##### 3. 이미지 업로드 API (파일 처리 로직만 재사용 ⭐)

**위치**: `server/index.js` (라인 4459-4894)

**기존 API**:
- `POST /api/direct/upload-image` - 모델 이미지 업로드 (Discord)

**재사용 가능한 부분**:
1. **파일 처리**: multer를 통한 파일 업로드 처리
2. **에러 핸들링**: 타임아웃, 재시도 로직

**재사용 불가능한 부분**:
- ❌ Discord 업로드 로직 (URL 만료 문제로 사용 안 함)

**매장 사진 업로드에 적용**:
- `POST /api/direct/store-image` - 매장 사진 URL 저장 (구글시트에 저장)
- `POST /api/direct/store-image/upload` - 매장 사진 파일 업로드
  - **Google Drive API를 통한 영구 저장** (Discord 사용 안 함)
  - 파일 처리 로직(multer) 재사용
  - 안정적인 이미지 URL 제공 (만료 없음)
  - 시트 저장 대상: `직영점_매장사진`

**성능 영향**: ✅✅ **매우 긍정적**
- 파일 처리 로직 재사용으로 코드 중복 제거
- 백엔드 서버 직접 저장으로 안정성 향상
- URL 만료 문제 해결
- **안정성**: Discord URL 만료 문제 완전 해결

##### 4. 폰클출고처데이터 조회 (재사용 가능 ⭐⭐)

**위치**: `server/index.js` (라인 1096-1220)

**재사용 방법**:
- `fetchSheetValuesDirectly('폰클출고처데이터')` 사용
- 이미 범위 설정됨 (A:AM)

**고객모드에서 사용**:
- VIP직영 매장 필터링 (18번 인덱스)
- 매장 정보 조회 (14, 15, 19, 22, 28, 29, 32, 35번 인덱스)
- POS코드 조회 (15번 인덱스, 구매대기 필터링용)

**성능 영향**: ✅ **긍정적**
- 캐싱으로 동일 데이터 중복 조회 방지
- 기존 함수 재사용으로 코드 중복 제거

#### 새로 구현해야 할 API

##### 1. 구매대기 API (판매일보 패턴 재사용, 헤더는 별도 정의)

**엔드포인트**:
- `GET /api/direct/purchase-queue` - 구매대기 조회
  - 필터링: 고객모드(CTN), 직영점모드(POS코드)
- `POST /api/direct/purchase-queue` - 구매대기 생성
- `PUT /api/direct/purchase-queue/:id` - 구매대기 수정
- `DELETE /api/direct/purchase-queue/:id` - 구매대기 삭제

**구현 방법**:
- 판매일보 API 코드를 복사하여 수정
- 시트명: `직영점_구매대기`로 변경
- **헤더는 별도 정의**: `PURCHASE_QUEUE_HEADERS` (A~AB 열, 마진 컬럼 제외)
  - 판매일보: A~Z 열 (마진 컬럼 포함)
  - 구매대기: A~AB 열 (마진 컬럼 제외, 구조 다름)
- 필터링 로직 추가 (CTN, POS코드)
- **재사용**: 헤더 보정 로직, 데이터 변환 로직, 행 생성/업데이트 패턴

**성능**: 판매일보와 동일한 성능 (캐싱, rate limiting 적용)

##### 2. 사전승낙서마크 API (간단한 CRUD)

**엔드포인트**:
- `GET /api/direct/pre-approval-mark/:storeName` - 조회
- `POST /api/direct/pre-approval-mark` - 저장/업데이트

**구현 방법**:
- `fetchSheetValuesDirectly`로 시트 읽기
- 업체명으로 행 찾기
- 있으면 업데이트, 없으면 append

**성능**: 캐싱 적용 가능 (5분 TTL)

##### 3. 매장 사진 API (파일 처리 로직만 재사용)

**엔드포인트**:
- `POST /api/direct/store-image` - 매장 사진 업로드
- `GET /api/direct/store-image/:storeName` - 매장 사진 조회

**구현 방법**:
- 파일 처리 로직(multer) 재사용
- **Google Drive API를 통한 영구 저장** (Discord 사용 안 함)
- 안정적인 이미지 URL 제공 (만료 없음)
- 시트 저장 대상: `직영점_매장사진`

**성능**: 백엔드 서버 직접 저장으로 안정성 향상

##### 4. 고객 로그인 인증 API (새로 구현)

**엔드포인트**:
- `POST /api/member/login` - 고객 로그인

**구현 방법**:
- `fetchSheetValuesDirectly('직영점_판매일보')`로 CTN 조회
- CTN에서 하이픈 제거하여 아이디 매칭
- CTN에서 `010` 뒤 4자리 추출하여 비밀번호 매칭

**성능**: 캐싱 적용 가능 (판매일보 시트 캐시 재사용)

#### 성능 최적화 전략

##### 1. 캐싱 활용
- ✅ 모든 시트 조회에 `fetchSheetValuesDirectly` 또는 `getSheetData` 사용
- ✅ 5분 TTL 캐시로 중복 조회 방지
- ✅ **예상 효과**: API 호출 수 50-70% 감소

##### 2. Rate Limiting
- ✅ `rateLimitedSheetsCall` 재사용
- ✅ 분당 45회 제한으로 할당량 초과 방지

##### 3. 동시 요청 제한
- ✅ 최대 10개 동시 요청으로 서버 부하 관리

##### 4. 배치 처리
- ✅ 구매대기 조회 시 필터링을 서버에서 처리 (클라이언트 필터링 최소화)

#### 재사용 우선순위

**최우선 재사용 (필수) ⭐⭐⭐**
1. `fetchSheetValuesDirectly` / `getSheetData` - 모든 시트 조회
2. `rateLimitedSheetsCall` - 모든 Google Sheets API 호출
3. 판매일보 API 패턴 (헤더 보정, 데이터 변환, 행 생성/업데이트 로직) - 구매대기 API 구현

**권장 재사용 ⭐⭐**
1. 파일 처리 로직 (multer) - 매장 사진 업로드
2. 헤더 보정 로직 - 구매대기 시트 헤더 관리 (별도 헤더 정의 필요)

**재사용 불가 ⚠️**
1. Discord 업로드 로직 - URL 만료 문제로 백엔드 서버 직접 저장으로 변경

**중요 주의사항 ⚠️**
1. **구매대기 API**: 판매일보와 컬럼 구조가 다름
   - 판매일보: A~Z 열 (마진 컬럼 포함)
   - 구매대기: A~AB 열 (마진 컬럼 제외)
   - **헤더는 별도 정의 필요**: `PURCHASE_QUEUE_HEADERS`
   - 패턴(헤더 보정, 데이터 변환, 행 생성/업데이트)만 재사용
2. **매장 사진 업로드**: Discord 사용 안 함
   - Google Drive API를 통한 영구 저장
   - 안정적인 URL 제공 (만료 없음)

**선택적 재사용 ⭐**
1. 데이터 변환 로직 - 필요시 재사용

#### 예상 성능 개선 효과

**API 호출 수 감소**
- **캐싱 적용 전**: 구매대기 조회 시마다 Google Sheets API 호출
- **캐싱 적용 후**: 5분간 캐시된 데이터 재사용
- **예상 감소율**: 50-70%

**응답 시간 개선**
- **캐시 히트 시**: < 10ms (메모리에서 조회)
- **캐시 미스 시**: 200-500ms (Google Sheets API 호출)
- **평균 응답 시간**: 50-70% 단축 예상

**서버 부하 감소**
- **동시 요청 제한**: 최대 10개로 제한
- **Rate Limiting**: 분당 45회로 제한
- **예상 효과**: 서버 부하 30-40% 감소

#### 결론

기존 API와 함수들을 적극적으로 재사용하면:
1. ✅ **개발 시간 단축**: 검증된 코드 재사용
2. ✅ **성능 향상**: 캐싱, rate limiting으로 API 호출 최적화
3. ✅ **안정성 향상**: 검증된 에러 핸들링, 재시도 로직
4. ✅ **유지보수 용이**: 공통 로직 중앙 관리

**권장 사항**: 모든 시트 조회는 `fetchSheetValuesDirectly` 또는 `getSheetData` 사용 필수

---

### 부록 C: 휴대폰시세표 탭과 휴대폰목록 탭 동기화 분석

#### 현재 구조

##### 직영점모드 휴대폰목록 탭
- **컴포넌트**: `MobileListTab`
- **API 호출**:
  - `directStoreApiClient.getMobilesMaster(carrier)` - 단말 마스터
  - `directStoreApiClient.getMobilesPricing(carrier)` - 가격 정책
  - `directStoreApiClient.getPlansMaster(carrier)` - 요금제 마스터
- **서버 엔드포인트**: 
  - `GET /api/direct/mobiles-master?carrier=SK`
  - `GET /api/direct/mobiles-pricing?carrier=SK`
  - `GET /api/direct/plans-master?carrier=SK`
- **서버 캐싱**: 
  - 캐시 키: `mobiles-${carrier}` (예: `mobiles-SK`)
  - TTL: 5분
- **수정 기능**:
  - 이미지 업로드: `POST /api/direct/upload-image`
  - 태그 업데이트: `PUT /api/direct/mobiles/:modelId/tags`

##### 고객모드 휴대폰시세표 탭 (계획)
- **컴포넌트**: `MobileListTab` (동일 컴포넌트 재사용)
- **API 호출**: 동일 (같은 API 엔드포인트 사용)
- **수정 기능**: 없음 (읽기 전용)

#### 동기화 메커니즘

##### 1. 데이터 소스 동기화 ✅

**동일한 데이터 소스 사용**:
- 둘 다 같은 Google Sheets 시트에서 데이터를 읽음:
  - `직영점_단말마스터`
  - `직영점_단말요금정책`
  - `직영점_요금제마스터`
  - `직영점_모델이미지`

**결론**: ✅ **데이터 소스는 완전히 동일**

##### 2. 서버 캐시 동기화 ✅

**캐시 키 구조**:
- 직영점모드: `mobiles-${carrier}` (예: `mobiles-SK`)
- 고객모드: `mobiles-${carrier}` (예: `mobiles-SK`) - **동일한 캐시 키 사용**

**캐시 무효화 메커니즘**:
1. **이미지 업로드 시**:
   ```javascript
   // server/index.js (라인 4840-4841)
   invalidateDirectStoreCache(carrier);
   // → deleteCache(`mobiles-${carrier}`)
   // → deleteCache('mobiles-SK'), deleteCache('mobiles-KT'), deleteCache('mobiles-LG')
   ```

2. **태그 업데이트 시**:
   ```javascript
   // server/directRoutes.js (라인 4608-4611)
   deleteCache('todays-mobiles');
   deleteCache(`mobiles-${carrier || 'SK'}`);
   deleteCache('mobiles-KT');
   deleteCache('mobiles-LG');
   ```

**동기화 작동 방식**:
1. 직영점모드에서 이미지 업로드 또는 태그 수정
2. 서버에서 Google Sheets에 저장
3. 서버에서 캐시 무효화 (`deleteCache('mobiles-SK')`)
4. 고객모드가 다음 API 요청 시:
   - 캐시가 없으므로 Google Sheets에서 최신 데이터 조회
   - 최신 데이터를 캐시에 저장
   - 고객모드에 최신 데이터 반환

**결론**: ✅ **서버 캐시 무효화로 자동 동기화됨**

**동기화 지연 시간**:
- 최대 5분 (캐시 TTL)
- 또는 직영점모드에서 수정 후 고객모드가 새로고침/재요청 시 즉시 반영

##### 3. 클라이언트 사이드 동기화 (현재는 없음)

**현재 구조**:
- 직영점모드 내부에서만 `window.dispatchEvent('imageUploaded')` 이벤트 사용
- 이 이벤트는 같은 브라우저 탭 내에서만 작동 (직영점모드 ↔ 오늘의휴대폰 탭)

**고객모드와의 실시간 동기화**:
- ❌ 현재는 실시간 동기화 없음
- ✅ 서버 캐시 무효화로 다음 요청 시 최신 데이터 반영

#### 수정 기능 동기화

##### 직영점모드에서 수정 시

**1. 이미지 업로드**:
- `POST /api/direct/upload-image` 호출
- Discord에 업로드 (또는 백엔드 서버에 저장)
- `직영점_모델이미지` 시트에 저장
- `직영점_단말마스터` 시트에 이미지 URL 업데이트
- **캐시 무효화**: `invalidateDirectStoreCache(carrier)`

**2. 태그 업데이트**:
- `PUT /api/direct/mobiles/:modelId/tags` 호출
- `직영점_오늘의휴대폰` 시트에 저장
- **캐시 무효화**: `deleteCache('mobiles-${carrier}')`

**고객모드 반영**:
- 다음 API 요청 시 캐시가 무효화되어 최신 데이터 조회
- **자동 동기화됨** ✅

##### 고객모드에서 수정 (계획상 없음)

- 고객모드는 읽기 전용
- 수정 기능 없음

#### 동기화 시나리오

##### 시나리오 1: 직영점모드에서 이미지 업로드

1. 직영점모드: 이미지 업로드
2. 서버: Google Sheets에 저장
3. 서버: 캐시 무효화 (`mobiles-SK`)
4. 고객모드: 
   - 현재 페이지에 있으면: 캐시된 데이터 표시 (최대 5분간 구 데이터)
   - 새로고침 또는 재요청 시: 최신 데이터 조회 및 표시 ✅

##### 시나리오 2: 직영점모드에서 태그 수정

1. 직영점모드: 태그 수정 (인기/추천 등)
2. 서버: `직영점_오늘의휴대폰` 시트에 저장
3. 서버: 캐시 무효화 (`mobiles-SK`)
4. 고객모드: 
   - 현재 페이지에 있으면: 캐시된 데이터 표시 (최대 5분간 구 데이터)
   - 새로고침 또는 재요청 시: 최신 데이터 조회 및 표시 ✅

#### 결론

##### ✅ 동기화 여부: **자동 동기화됨**

**이유**:
1. **같은 컴포넌트 사용**: `MobileListTab` 재사용
2. **같은 API 호출**: 동일한 엔드포인트 사용
3. **같은 캐시 키**: `mobiles-${carrier}` 동일
4. **서버 캐시 무효화**: 수정 시 캐시 무효화로 다음 요청 시 최신 데이터 반영

##### ⚠️ 동기화 지연

**지연 시간**:
- 최대 5분 (캐시 TTL)
- 또는 고객모드에서 새로고침/재요청 시 즉시 반영

**개선 방안 (선택사항)**:
- 실시간 동기화를 원한다면:
  - WebSocket 또는 Server-Sent Events (SSE) 사용
  - 또는 고객모드에서 주기적 폴링 (예: 30초마다)
  - 또는 고객모드에서도 `imageUploaded` 이벤트 리스너 추가

#### 권장사항

##### 현재 구조 유지 (권장)

**이유**:
1. ✅ 서버 캐시 무효화로 자동 동기화됨
2. ✅ 5분 지연은 허용 가능한 수준
3. ✅ 추가 구현 없이 작동
4. ✅ 서버 부하 최소화

##### 개선이 필요한 경우

**실시간 동기화가 필요한 경우**:
1. 고객모드에서 주기적 폴링 (30초~1분)
2. 또는 고객모드에서도 `imageUploaded` 이벤트 리스너 추가
3. 또는 WebSocket/SSE로 실시간 알림

**현재는 추가 구현 불필요**: 서버 캐시 무효화로 충분히 동기화됨

---

## 참고사항
- 구현은 계획이 최종 완료된 후 시작
- 계획 단계에서는 요구사항과 기능만 정리
- 구현 시작 시 "고객모드를 구현시작해줘" 명령으로 시작

## 데이터 시트 구조

### 직영점_판매일보 시트
- **CTN 컬럼**: 고객 전화번호 (하이픈 포함)
  - 로그인 아이디: 하이픈 제거
  - 로그인 비밀번호: 가운데 4자리

### 폰클출고처데이터 시트
- **18번 인덱스(열)**: "VIP직영" 값으로 필터링
- **14번 인덱스**: 업체명
- **15번 인덱스**: POS코드 (직영점모드 로그인 시 사용되는 아이디, 구매대기 필터링용)
- **19번 인덱스**: 전화
- **22번 인덱스**: 휴대폰
- **28번 인덱스**: 사업자번호
- **29번 인덱스**: 점장명
- **32번 인덱스**: 매장주소
- **35번 인덱스**: 계좌정보

### 사전승낙서마크 저장 시트
- **시트명**: `직영점_사전승낙서마크`
- **컬럼 헤더 (A~C)**:
  - A열: `업체명` (또는 매장ID/매장식별자)
  - B열: `사전승낙서마크URL` (HTML 링크 태그 전체)
  - C열: `수정일시` (저장 시점)

### 매장 사진 저장 시트
- **시트명**: `직영점_매장사진`
- **컬럼 헤더 (A~J)**:
  - A열: `업체명` (폰클출고처데이터 시트의 14번 인덱스와 매칭)
  - B열: `전면사진URL` (서버에 저장된 이미지 URL)
  - C열: `내부사진URL`
  - D열: `외부사진URL`
  - E열: `외부2사진URL`
  - F열: `점장사진URL`
  - G열: `직원1사진URL`
  - H열: `직원2사진URL`
  - I열: `직원3사진URL`
  - J열: `수정일시` (저장 시점)

### 구매대기 데이터 저장 시트
- **시트명**: `직영점_구매대기`
- **컬럼 헤더 (A~AB)**: (판매일보와 달리 마진 컬럼 제외)
- **헤더 정의**: `PURCHASE_QUEUE_HEADERS` (별도 정의 필요, 판매일보와 구조 다름)
  - A열: `번호` (내부 ID, `pending-{timestamp}` 등)
  - B열: `고객CTN` (고객 전화번호, 하이픈 포함)
  - C열: `고객명`
  - D열: `통신사`
  - E열: `단말기모델명`
  - F열: `색상`
  - G열: `단말일련번호`
  - H열: `유심모델명`
  - I열: `유심일련번호`
  - J열: `개통유형` (신규/번호이동/기기변경)
  - K열: `전통신사`
  - L열: `할부구분` (할부/현금)
  - M열: `할부개월`
  - N열: `약정` (일반약정/선택약정)
  - O열: `요금제`
  - P열: `부가서비스` (CSV 문자열)
  - Q열: `출고가`
  - R열: `이통사지원금`
  - S열: `대리점추가지원금(부가유치)`
  - T열: `대리점추가지원금(부가미유치)`
  - U열: `선택매장업체명` (고객이 선택한 매장의 업체명)
  - V열: `선택매장전화` (선택한 매장의 전화번호)
  - W열: `선택매장주소` (선택한 매장의 주소)
  - X열: `선택매장계좌정보` (선택한 매장의 계좌정보)
  - Y열: `등록일시` (구매대기 등록 시점)
  - Z열: `상태` (구매대기/처리완료 등)
  - AA열: `처리매장업체명` (처리한 매장의 업체명, 처리 시 입력)
  - AB열: `처리일시` (처리 완료 시점)
- **데이터 조회 방식**:
  - 고객모드: 로그인한 CTN(아이디)로 저장된 구매대기만 조회
  - 직영점모드: `선택매장업체명`(U열)로 `폰클출고처데이터` 시트에서 POS코드 조회 후, 로그인한 매장의 POS코드와 매칭하여 필터링
  - 직영점관리모드: 전체 데이터 조회

---

## 변경 이력
- 2024-12-XX: 초기 문서 생성
- 2024-12-XX: `/member` 경로 사용 가능 여부 확인 완료 (사용 가능)
- 2024-12-XX: React Router 도입 결정 및 확정
- 2024-12-XX: 불필요한 옵션 제거 및 문서 정리
- 2024-12-XX: 고객모드 접속 시 직영점모드 휴대폰목록 페이지 렌더링 요구사항 추가
- 2024-12-XX: 로그인 시스템, 탭 구조, 지도 화면, 구매대기 기능 상세 요구사항 추가
- 2024-12-XX: 직영점모드/직영점관리모드 구매대기 탭 추가 요구사항
- 2024-12-XX: 개통정보 입력 페이지 매장 정보 표시 요구사항 추가 (직영점모드/고객모드 공통)
- 2024-12-XX: 개통정보 입력 페이지에 계좌정보 표시 요구사항 추가
- 2024-12-XX: 고객모드 개통정보 입력 페이지 안내문구 추가 요구사항
- 2024-12-XX: 고객모드 로그인 화면 디자인 및 홍보 문구 요구사항 추가
- 2024-12-XX: 고객모드 탭 이름 변경 (휴대폰목록 → 휴대폰시세표)
- 2024-12-XX: 구매대기 탭 행 선택, 수정/삭제, 선호매장 수정 기능 추가 요구사항
- 2024-12-XX: 고객모드 플로우 상세 정의 (상품/매장 선택 순서, 안내 페이지, 상태 관리)
- 2024-12-XX: 매장 사진 업로드 기능 추가 (전면/내부/외부/외부2, 점장/직원 사진)
- 2024-12-XX: 계획 검토 및 상세화 (CTN 비밀번호 추출 로직, 선택 상태 관리, 권한 체계, 개인정보 마스킹, 마진 컬럼 제거, POS코드 필터링, 개통정보 입력 페이지 Props 구조)
- 2024-12-XX: 기존 API 재사용 분석 완료 (판매일보 API 패턴, Google Sheets 공통 함수, 이미지 업로드 패턴 재사용 계획)
- 2024-12-XX: 구매대기 API 헤더 별도 정의 필요 (마진 컬럼 제외), 매장 사진 업로드는 백엔드 서버 직접 저장 (Discord 사용 안 함)
- 2024-12-XX: 고객모드 휴대폰시세표 탭과 직영점모드 휴대폰목록 탭 동기화 분석 완료 (자동 동기화됨, 최대 5분 지연)
- 2024-12-XX: 고객모드 구현 완료 및 계획 문서 체크리스트 업데이트
  - OpeningInfoPage에 사전승낙서 마크 표시 기능 추가 완료
  - 모든 주요 기능 구현 완료 확인
  - 모든 작업 완료: 사전승낙서마크/매장사진 업로드 UI (직영점모드/관리모드 별도 관리 페이지 완료), 파일 업로드 API 구현 완료 (Google Drive API 사용)

## 구현 완료 상태 요약

### ✅ 완료된 기능
1. **기본 구조**: 라우팅, 로그인, 대시보드
2. **로그인 시스템**: CTN 기반 인증, 홍보 문구 포함 로그인 화면
3. **고객 대시보드**: 3개 탭 구조 (휴대폰시세표, 선호구입매장, 구매대기)
4. **안내 페이지**: 플로우별 안내 메시지 및 네비게이션
5. **휴대폰시세표 탭**: MobileListTab 재사용, 읽기 전용
6. **선호구입매장 탭**: 지도 표시, VIP직영 매장 필터링, 매장 정보 표시, 사전승낙서마크/매장사진 표시
7. **개통정보 입력 페이지**: 모드 구분, 매장 정보 표시 (사전승낙서 마크 포함), 고객모드 안내문구
8. **구매대기 탭**: 테이블 구현, 개인정보 마스킹, 수정/삭제, 선호매장 수정
9. **직영점모드/관리모드 구매대기 탭**: 필터링, 마스킹 처리
10. **API 구현**: 구매대기 API, 사전승낙서마크 API, 매장 사진 조회/저장 API, 고객 로그인 API

### ✅ 추가 구현 완료
1. **사전승낙서마크 입력 UI**: ✅ 완료 - 직영점모드/관리모드에 "선호구입매장" 탭 추가, 매장 선택 시 편집 다이얼로그에서 사전승낙서마크 입력 및 저장
2. **매장 사진 업로드 UI**: ✅ 완료 - 직영점모드/관리모드 "선호구입매장" 탭에서 매장 사진 파일 업로드 및 저장
3. **파일 업로드 API**: ✅ 완료 - Google Drive API를 통한 이미지 파일 영구 저장 구현

**구현 내용**:
- `DirectStorePreferredStoreTab` 컴포넌트 생성 (직영점모드/관리모드 공통 사용)
- DirectStoreMode.js에 "선호구입매장" 탭 추가 (5번째 탭)
- DirectStoreManagementMode.js에 "선호구입매장" 탭 추가
- 지도에서 매장 클릭 시 편집 다이얼로그 표시
- 편집 다이얼로그에서 사전승낙서마크 HTML 입력 및 저장
- 편집 다이얼로그에서 매장 사진 파일 업로드 (전면, 내부, 외부, 외부2, 점장, 직원1-3)
- Google Drive API를 통한 이미지 파일 영구 저장
- 업로드된 이미지 URL 자동 입력 및 구글시트 저장








