# 매장 사진 파일 저장 영구 보존 방안

## 문제점
- CloudType 백엔드는 서버리스 플랫폼이므로 파일 시스템이 영구적이지 않음
- 현재 구현: `public/uploads/store-images/`에 저장 → 서버 재시작 시 삭제될 수 있음

## 해결 방안

### ✅ 옵션 1: Google Drive API 사용 (추천 ⭐⭐⭐)
**장점:**
- 이미 Google Sheets API를 사용 중이므로 추가 설정 최소화
- 무료 할당량: 15GB (충분함)
- 영구 저장 보장
- Google 계정으로 관리 가능

**구현 방법:**
1. Google Drive API 활성화 (이미 Google Sheets API 사용 중이면 추가 설정만)
2. 업로드된 파일을 Google Drive에 저장
3. 공개 링크 생성하여 URL 반환
4. URL을 구글시트에 저장

**예상 작업 시간:** 1-2시간

---

### ✅ 옵션 2: ImgBB API 사용 (간단함 ⭐⭐⭐)
**장점:**
- 무료 API 제공
- 별도 계정 생성 불필요 (API 키만)
- 즉시 사용 가능
- 영구 저장 (무료 플랜)

**단점:**
- 무료 플랜: 32MB 파일 크기 제한
- 외부 서비스 의존

**구현 방법:**
1. ImgBB API 키 발급 (https://api.imgbb.com/)
2. 파일을 Base64로 인코딩
3. ImgBB API로 업로드
4. 반환된 URL을 구글시트에 저장

**예상 작업 시간:** 30분-1시간

---

### ✅ 옵션 3: Cloudinary 사용 (프로페셔널 ⭐⭐)
**장점:**
- 무료 플랜: 25GB 저장, 25GB 대역폭
- 이미지 최적화 자동 제공
- CDN 제공으로 빠른 로딩
- 다양한 이미지 변환 기능

**단점:**
- 계정 생성 필요
- 무료 플랜 제한 있음

**예상 작업 시간:** 1-2시간

---

### ✅ 옵션 4: Base64로 구글시트에 직접 저장 (간단하지만 제한적 ⭐)
**장점:**
- 추가 서비스 불필요
- 이미 구글시트 사용 중

**단점:**
- 구글시트 셀 크기 제한 (약 50,000자)
- 작은 이미지만 가능 (약 30-40KB)
- 시트 파일 크기 증가

**예상 작업 시간:** 30분

---

### ✅ 옵션 5: Vercel Blob Storage (Vercel 사용 시 ⭐⭐)
**장점:**
- Vercel과 완벽 통합
- 무료 플랜: 1GB 저장, 100GB 대역폭
- 빠른 CDN

**단점:**
- Vercel 계정 필요
- 프론트엔드에서 직접 업로드 불가 (백엔드 API 필요)

**예상 작업 시간:** 1-2시간

---

## 추천 순서

1. **ImgBB API** (가장 빠르고 간단)
2. **Google Drive API** (이미 Google API 사용 중이므로 통합 용이)
3. **Cloudinary** (프로페셔널한 이미지 관리 필요 시)

---

## 구현 예시 (ImgBB API)

### 서버 측 (`server/index.js`)
```javascript
// POST /api/direct/store-image/upload: 매장 사진 파일 업로드 (ImgBB 사용)
app.post('/api/direct/store-image/upload', storeImageUpload.single('image'), async (req, res) => {
  try {
    if (!req.file) {
      return res.status(400).json({ error: '이미지 파일이 없습니다.' });
    }

    const storeName = req.body.storeName;
    const photoType = req.body.photoType;

    if (!storeName || !photoType) {
      return res.status(400).json({ error: '매장명과 사진 타입이 필요합니다.' });
    }

    // 파일을 Base64로 인코딩
    const fileBuffer = fs.readFileSync(req.file.path);
    const base64Image = fileBuffer.toString('base64');

    // ImgBB API로 업로드
    const formData = new FormData();
    formData.append('key', process.env.IMGBB_API_KEY);
    formData.append('image', base64Image);

    const imgbbResponse = await fetch('https://api.imgbb.com/1/upload', {
      method: 'POST',
      body: formData
    });

    const imgbbData = await imgbbResponse.json();

    if (!imgbbData.success) {
      throw new Error('ImgBB 업로드 실패');
    }

    // 로컬 파일 삭제
    fs.unlinkSync(req.file.path);

    res.json({
      success: true,
      url: imgbbData.data.url,
      deleteUrl: imgbbData.data.delete_url // 필요시 삭제용
    });
  } catch (error) {
    console.error('매장 사진 업로드 오류:', error);
    if (req.file && req.file.path) {
      try {
        fs.unlinkSync(req.file.path);
      } catch (unlinkError) {
        console.error('파일 삭제 실패:', unlinkError);
      }
    }
    res.status(500).json({ error: '업로드에 실패했습니다: ' + error.message });
  }
});
```

---

## 다음 단계

어떤 옵션을 선택하시겠습니까?
1. **ImgBB API** - 가장 빠르고 간단 (추천)
2. **Google Drive API** - 이미 Google API 사용 중
3. **Cloudinary** - 프로페셔널한 이미지 관리
4. **기타** - 다른 서비스 제안

선택해주시면 해당 옵션으로 구현하겠습니다.


