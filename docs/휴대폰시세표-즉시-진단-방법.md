# 휴대폰 시세표 즉시 진단 방법

## 🔍 브라우저에서 직접 확인

### 1단계: 브라우저 개발자 도구 열기
1. 직영점 모드 접속
2. `F12` 키를 눌러 개발자 도구 열기
3. `Console` 탭 선택

### 2단계: API 직접 호출
다음 코드를 Console에 붙여넣고 실행:

```javascript
// LG 통신사 단말 마스터 조회
fetch('https://vipmobile-server.app.cloudtype.app/api/direct/mobiles-master?carrier=LG')
  .then(res => res.json())
  .then(data => {
    console.log('✅ 단말 마스터 조회 성공:', data);
    console.log('데이터 개수:', data.data?.length || 0);
    if (data.data && data.data.length > 0) {
      console.log('첫 번째 데이터:', data.data[0]);
    }
  })
  .catch(err => {
    console.error('❌ 단말 마스터 조회 실패:', err);
  });
```

```javascript
// LG 통신사 요금제 마스터 조회
fetch('https://vipmobile-server.app.cloudtype.app/api/direct/plans-master?carrier=LG')
  .then(res => res.json())
  .then(data => {
    console.log('✅ 요금제 마스터 조회 성공:', data);
    console.log('데이터 개수:', data.data?.length || 0);
  })
  .catch(err => {
    console.error('❌ 요금제 마스터 조회 실패:', err);
  });
```

```javascript
// LG 통신사 단말 요금정책 조회
fetch('https://vipmobile-server.app.cloudtype.app/api/direct/mobiles-pricing?carrier=LG')
  .then(res => res.json())
  .then(data => {
    console.log('✅ 단말 요금정책 조회 성공:', data);
    console.log('데이터 개수:', data.data?.length || 0);
    if (data.data && data.data.length > 0) {
      console.log('첫 번째 데이터:', data.data[0]);
    }
  })
  .catch(err => {
    console.error('❌ 단말 요금정책 조회 실패:', err);
  });
```

### 3단계: 결과 확인

#### ✅ 정상인 경우:
```
✅ 단말 마스터 조회 성공: { success: true, data: [...] }
데이터 개수: 50
첫 번째 데이터: { carrier: 'LG', modelId: 'LM-G900N', model: 'V60', ... }
```

#### ❌ 에러인 경우:
```
❌ 단말 마스터 조회 실패: Error: ...
```
또는
```
✅ 단말 마스터 조회 성공: { success: false, error: '...', message: '...' }
데이터 개수: 0
```

## 🔧 에러별 해결 방법

### 에러 1: "데이터 개수: 0" (데이터가 비어있음)
**원인:** 마스터 데이터가 아직 빌드되지 않았거나 링크설정이 잘못됨

**해결:**
```javascript
// 마스터 데이터 재빌드
fetch('https://vipmobile-server.app.cloudtype.app/api/direct/rebuild-master?carrier=LG', {
  method: 'POST'
})
  .then(res => res.json())
  .then(data => {
    console.log('✅ 마스터 데이터 재빌드 완료:', data);
  })
  .catch(err => {
    console.error('❌ 마스터 데이터 재빌드 실패:', err);
  });
```

재빌드 후 1-2분 기다린 다음 다시 조회

### 에러 2: "시트를 찾을 수 없습니다"
**원인:** 링크설정의 시트 ID가 잘못되었거나 시트가 삭제됨

**해결:**
1. Google Sheets에서 "직영점_설정" 시트 열기
2. LG 통신사의 `support` 설정 행 확인
3. "시트ID" 컬럼의 값이 올바른지 확인
4. 해당 시트 ID로 시트를 열어서 존재하는지 확인

### 에러 3: "시트 접근 권한이 없습니다"
**원인:** 서비스 계정이 외부 시트에 접근할 권한이 없음

**해결:**
1. 링크설정의 시트 ID로 해당 시트 열기
2. 우측 상단 "공유" 버튼 클릭
3. 서비스 계정 이메일 추가 (환경변수 `GOOGLE_SERVICE_ACCOUNT_EMAIL` 값)
4. 권한을 "뷰어" 이상으로 설정

### 에러 4: "정책 설정을 불러올 수 없습니다"
**원인:** 정책 마진 시트가 비어있거나 형식이 잘못됨

**해결:**
1. Google Sheets에서 "직영점_정책_마진" 시트 열기
2. LG 통신사 행이 있는지 확인
3. 형식 확인:
   - A열: 통신사 (LG)
   - B열: 마진 (숫자, 예: 50000)

## 📊 Network 탭에서 확인

### 1단계: Network 탭 열기
1. 개발자 도구에서 `Network` 탭 선택
2. 필터에 "mobiles-master" 입력

### 2단계: 페이지 새로고침
1. 휴대폰시세표 탭 클릭
2. Network 탭에서 API 호출 확인

### 3단계: 응답 확인
1. `mobiles-master?carrier=LG` 요청 클릭
2. `Response` 탭에서 응답 내용 확인
3. `Headers` 탭에서 상태 코드 확인 (200이어야 정상)

#### 정상 응답:
```json
{
  "success": true,
  "data": [
    {
      "carrier": "LG",
      "modelId": "LM-G900N",
      "model": "V60",
      "petName": "V60",
      "factoryPrice": 1199000,
      "imageUrl": "https://...",
      ...
    }
  ]
}
```

#### 에러 응답:
```json
{
  "success": false,
  "error": "단말 마스터 조회 실패",
  "message": "시트를 찾을 수 없습니다. 링크설정에서 시트 ID를 확인해주세요: ..."
}
```

## 🚨 긴급 조치

위 방법으로도 해결되지 않는 경우:

### 1. 서버 로그 전체 확인
Cloudtype 콘솔에서 서버 로그 전체를 확인하여 다음 메시지 찾기:
- `❌ [getSheetData] 시트 데이터 읽기 실패`
- `❌ [rebuildPricingMaster] ... 정책 설정을 불러올 수 없습니다`
- `🔍 [getLinkSettings] LG 링크설정 읽기 시작`
- `✅ [getLinkSettings] LG 링크설정 읽기 완료`

### 2. 캐시 완전 삭제
```javascript
// 브라우저 Console에서 실행
localStorage.clear();
sessionStorage.clear();
location.reload();
```

### 3. 서버 재시작
Cloudtype 콘솔에서 서버 재시작

## 📞 추가 지원

위 모든 방법을 시도했는데도 해결되지 않는 경우:
1. Console 탭의 모든 에러 메시지 캡처
2. Network 탭의 API 응답 캡처
3. 서버 로그 전체 내용 확인
4. 관리자에게 문의
