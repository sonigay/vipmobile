# 매장간 퀵비용 예상 기능 구현 플랜 (완전판)

## 📋 목차
1. [프론트엔드 구현](#1-프론트엔드-구현)
2. [백엔드 구현](#2-백엔드-구현)
3. [구글시트 구조](#3-구글시트-구조)
4. [모드 설정 추가](#4-모드-설정-추가)
5. [구현 세부사항](#5-구현-세부사항)
6. [파일 변경 목록](#6-파일-변경-목록)
7. [테스트 시나리오](#7-테스트-시나리오)
8. [구현 진행 상황 요약](#8-구현-진행-상황-요약)
9. [최근 수정 내역](#9-최근-수정-내역)
10. [작업 규칙](#10-작업-규칙)

---

## 1. 프론트엔드 구현

### 1.1 Map.js 수정

#### 일반모드 (기본모드)
- [x] Popup에 "예상퀵비" 표시 (QuickCostPreview 컴포넌트)
- [x] Popup에 "퀵비등록" 버튼 추가
  - 위치: 주소 아래, 재고 위
  - 버튼: "선택됨/퀵비등록" (기존 "선택됨" 옆에 추가)
  - "영업사원요청문구/기억" 버튼은 아래로 이동
  - QuickCostPreview 내부에도 데이터 없을 때 등록 버튼 표시
- [x] 매장 선택 시 Popup 자동 열기 기능
- [x] 매장 선택 변경 시 퀵비용 정보 업데이트

#### 관리자모드
- [x] Popup에 "예상퀵비" 표시 (QuickCostPreview 컴포넌트)
- [x] Popup에 "퀵비등록" 버튼 추가
  - 위치: 매장명 아래, 모델명/색상 정보 위
  - 버튼: "선택됨/기억/퀵비등록" (기존 버튼 옆에 추가)
  - QuickCostPreview 내부에도 데이터 없을 때 등록 버튼 표시

### 1.2 퀵비등록 모달 컴포넌트 생성 (QuickCostModal.js)

#### 구현 상태: ✅ 완료

#### 일반모드용
- [x] 상단: "나의 매장 <-> 선택된 매장" 매장명 표시
- [x] 퀵서비스업체 정보 입력 폼 (업체명, 전화번호, 비용, 배차속도, 픽업속도, 도착속도)
- [x] "다른 업체 정보 추가" 버튼 (최대 5개)

#### 관리자모드용
- [x] 상단: "재고요청점 검색된 매장 <-> 선택된 매장" 매장명 표시
- [x] 동일한 입력 폼 구조

#### 데이터 기반 선택 필드 제공
- [x] 업체명: 기존 등록된 업체명 목록에서 선택 (드롭다운) + "직접 입력" 옵션
- [x] 대표번호: 선택한 업체명의 기존 등록된 전화번호 목록에서 선택 (드롭다운) + "직접 입력" 옵션
- [x] 비용: 선택한 업체명+전화번호 조합의 기존 등록된 비용 목록에서 선택 (드롭다운) + "직접 입력" 옵션
- [x] 배차속도: 라디오 버튼 또는 드롭다운 (빠름, 중간, 느림) - 필수 입력
- [x] 픽업속도: 라디오 버튼 또는 드롭다운 (빠름, 중간, 느림) - 필수 입력
- [x] 도착속도: 라디오 버튼 또는 드롭다운 (빠름, 중간, 느림) - 필수 입력

#### 자동 갱신 로직
- [x] 각 필드에서 "직접 입력" 선택 시 텍스트 입력 필드로 전환
- [x] 업체명 변경 시 대표번호 목록 자동 갱신
- [x] 업체명 또는 대표번호 변경 시 비용 목록 자동 갱신

#### 입력값 검증
- [x] 비용: 음수/0 체크, 최대값 제한(1,000,000원)
- [x] 전화번호: 형식 검증(숫자, 하이픈 허용)
- [x] 업체명: 최소/최대 길이(1~50자), 특수문자 제한

### 1.3 예상퀵비 표시 컴포넌트 (EstimatedQuickCost.js)

#### 구현 상태: ✅ 완료

#### 기본 기능
- [x] 구글시트에서 해당 매장간 데이터 조회
- [x] 업체별 평균 비용 계산 (이상치 제외)
- [x] 가격 순으로 정렬하여 표시 (가장 저렴한 업체 1순위)
- [x] 이상치 탐지: 평균 대비 20% 이상 차이 시 경고 표시
- [x] 업체명, 전화번호, 예상비용 표시

#### 서비스 품질 정보 표시
- [x] 배차속도: 가장 많이 선택된 값 표시 (빠름/중간/느림)
- [x] 픽업속도: 가장 많이 선택된 값 표시 (빠름/중간/느림)
- [x] 도착속도: 가장 많이 선택된 값 표시 (빠름/중간/느림)
- [x] 각 속도는 아이콘 또는 색상으로 시각적 표시 (빠름: 초록색 ⚡, 중간: 노란색 ⏱️, 느림: 빨간색 🐌)

#### 표시 기능
- [x] 모든 업체를 가격 비교 형태로 표시

#### 검색 및 필터링
- [x] 업체명 검색 기능
- [x] 가격대 필터 (5천원 이하, 1만원 이하 등)
- [x] 속도별 필터 (빠름만 보기 등)

#### 최근 사용 업체
- [x] 로컬스토리지에 최근 등록한 업체명/전화번호 저장
- [x] 최근 사용 업체 자동완성 우선 표시

#### 즐겨찾기 업체
- [x] 자주 사용하는 업체 즐겨찾기 기능
- [x] 즐겨찾기 업체 우선 표시

### 1.4 API 연동 (src/api.js)

#### 구현 상태: ✅ 대부분 완료 (수정/삭제 미구현)

- [x] `saveQuickCost()`: 퀵비용 데이터 저장
- [x] `getEstimatedQuickCost()`: 예상퀵비 조회 (캐싱 적용)
- [x] `getQuickServiceCompanies()`: 등록된 퀵서비스 업체명 목록 조회 (캐싱 적용)
- [x] `getQuickServicePhoneNumbers(companyName)`: 특정 업체의 전화번호 목록 조회 (캐싱 적용)
- [x] `getQuickServiceCosts(companyName, phoneNumber)`: 특정 업체+전화번호의 비용 목록 조회 (캐싱 적용)
- [x] `getQuickServiceHistory()`: 내가 등록한 퀵비용 이력 조회
- [ ] `updateQuickCost(id, data)`: 퀵비용 수정 (본인 등록만)
- [ ] `deleteQuickCost(id)`: 퀵비용 삭제 (본인 등록만)

### 1.5 퀵서비스 관리 모드 컴포넌트 생성 (QuickServiceManagementMode.js)

#### 구현 상태: ❌ 미구현

#### 권한 설정
- [ ] 권한: 대리점아이디관리 시트 AF열(31인덱스) 체크
- [ ] 업데이트: 어플업데이트 시트 Y열(24인덱스)에 저장

#### 주요 기능

##### 대시보드
- [ ] 전체 등록 건수 통계
- [ ] 지역별 등록 현황
- [ ] 최근 등록 추이 그래프

##### 업체 관리
- [ ] 업체별 통계 (평균 비용, 평균 속도, 등록 건수, 신뢰도 점수)
- [ ] 지역별 인기 업체 순위 (등록 건수 기준)
- [ ] 지역별 우수 업체 순위 (평균 속도 기준)
- [ ] 업체명 정규화 관리 (유사 업체명 병합 제안)

##### 데이터 품질 관리
- [ ] 이상치 데이터 목록 및 검토
- [ ] 데이터 정규화 상태 모니터링
- [ ] 업체명 중복률 통계
- [ ] 데이터 신뢰도 점수 관리

##### 통계 및 분석
- [ ] 매장간 거리별 평균 비용 분석
- [ ] 거리와 비용 상관관계 시각화
- [ ] 시간대별 추이 분석 (월별/주별 비용 변화)
- [ ] 계절별 패턴 분석

##### 데이터 수정/삭제
- [ ] 모든 등록 데이터 수정/삭제 권한
- [ ] 수정 이력 추적

---

## 2. 백엔드 구현

### 2.1 API 엔드포인트 추가 (server/index.js)

#### 구현 상태: ✅ 대부분 완료 (수정/삭제 미구현)

#### POST /api/quick-cost/save
- [x] 구글시트에 퀵비용 데이터 저장
- [x] 시트명: 퀵비용관리
- [x] 데이터 정규화:
  - [x] 전화번호: 하이픈 제거
  - [x] 업체명: 공백 제거 후 저장
  - [x] 여러 업체 정보를 한 행에 저장 (업체1~5)
  - [x] 각 업체마다 배차속도, 픽업속도, 도착속도 정보 저장 (빠름/중간/느림)
- [x] 입력값 검증:
  - [x] 비용: 0보다 크고 1,000,000 이하
  - [x] 전화번호: 숫자만 허용
  - [x] 업체명: 1~50자
- [x] **양방향 자동 반영 기능** (추가 요구사항)
  - [x] A↔B로 저장 시 B↔A도 자동으로 같은 데이터로 저장
  - [x] 예: "넘버원모바일2호(시흥대야) ↔ 정직폰강서점(서울마곡)" 저장 시
  - [x] "정직폰강서점(서울마곡) ↔ 넘버원모바일2호(시흥대야)"도 자동 저장
  - [x] 프론트엔드에서 양방향 저장 API 호출 (Promise.all 사용)

#### GET /api/quick-cost/estimate
- [x] 매장간 예상퀵비 조회
- [x] 파라미터: fromStoreId, toStoreId
- [x] 캐싱: 5분 TTL
- [x] 로직:
  - [x] 해당 매장간 모든 데이터 조회
  - [x] 업체명 정규화 (공백 제거)하여 그룹화
  - [x] 전화번호 정규화 (하이픈 제거)하여 그룹화
  - [x] 업체별 평균 비용 계산
  - [x] 이상치 탐지 (평균 대비 20% 이상 차이)
  - [x] 업체별 서비스 품질 정보 계산:
    - [x] 배차속도: 가장 많이 선택된 값 (빠름/중간/느림)
    - [x] 픽업속도: 가장 많이 선택된 값 (빠름/중간/느림)
    - [x] 도착속도: 가장 많이 선택된 값 (빠름/중간/느림)
  - [x] 가격 순으로 정렬하여 반환

#### GET /api/quick-cost/companies
- [x] 등록된 퀵서비스 업체명 목록 조회
- [x] 캐싱: 10분 TTL
- [x] 업체명 정규화 (공백 제거)하여 유니크 목록 반환
- [x] 알파벳 순으로 정렬

#### GET /api/quick-cost/phone-numbers
- [x] 특정 업체명의 등록된 전화번호 목록 조회
- [x] 파라미터: companyName (정규화된 업체명)
- [x] 캐싱: 10분 TTL
- [x] 전화번호 정규화 (하이픈 제거)하여 유니크 목록 반환
- [x] 오름차순 정렬

#### GET /api/quick-cost/costs
- [x] 특정 업체명+전화번호 조합의 등록된 비용 목록 조회
- [x] 파라미터: companyName, phoneNumber (정규화된 값)
- [x] 캐싱: 10분 TTL
- [x] 비용 목록 반환 (중복 제거, 오름차순 정렬)

#### GET /api/quick-cost/history
- [x] 사용자가 등록한 퀵비용 이력 조회
- [x] 파라미터: userId 또는 storeId
- [x] 등록일시 역순 정렬

#### PUT /api/quick-cost/:id
- [ ] 퀵비용 데이터 수정
- [ ] 본인 등록만 수정 가능 (또는 관리자)
- [ ] 수정 이력 기록

#### DELETE /api/quick-cost/:id
- [ ] 퀵비용 데이터 삭제
- [ ] 본인 등록만 삭제 가능 (또는 관리자)

#### GET /api/quick-cost/statistics
- [x] 퀵서비스 통계 데이터 조회 (관리자 전용)
- [x] 파라미터: region (지역별 필터링)
- [x] 반환 데이터:
  - [x] 업체별 통계 (평균 비용, 평균 속도, 등록 건수, 신뢰도 점수)
  - [x] 지역별 인기 업체 순위 (등록 건수 기준)
  - [x] 지역별 우수 업체 순위 (평균 속도 기준)
  - [x] 매장간 거리별 평균 비용
  - [x] 시간대별 추이 데이터

#### GET /api/quick-cost/quality
- [x] 데이터 품질 정보 조회 (관리자 전용)
- [x] 반환 데이터:
  - [x] 이상치 데이터 목록
  - [x] 데이터 정규화 상태
  - [x] 업체명 중복률
  - [x] 데이터 신뢰도 점수

#### POST /api/quick-cost/normalize
- [x] 업체명 정규화 제안 (관리자 전용)
- [x] 유사 업체명 자동 병합 제안
- [x] 파라미터: companyName1, companyName2

### 2.2 데이터 처리 로직

#### 구현 상태: ✅ 완료

- [x] 업체명 정규화: 공백 제거, 소문자 변환
- [x] 전화번호 정규화: 하이픈, 공백 제거, 숫자만 추출
- [x] 이상치 탐지:
  - [x] 업체별 평균 계산
  - [x] 평균 대비 20% 이상 차이나는 데이터 식별
  - [x] 이상치가 포함된 경우 플래그 반환
- [x] 신뢰도 점수 계산:
  - [x] 등록 건수 기반 (더 많은 등록 = 높은 신뢰도)
  - [x] 데이터 일관성 기반 (비용 분산이 작을수록 높은 신뢰도)
  - [x] 이상치 비율 기반 (이상치가 적을수록 높은 신뢰도)

### 2.3 선택 옵션 데이터 제공 로직

#### 구현 상태: ✅ 완료

- [x] 업체명 목록: 모든 행의 업체명1~5를 수집하여 정규화 후 유니크 목록 생성
- [x] 전화번호 목록: 특정 업체명의 모든 행에서 해당 업체의 전화번호를 수집하여 정규화 후 유니크 목록 생성
- [x] 비용 목록: 특정 업체명+전화번호 조합의 모든 행에서 해당 조합의 비용을 수집하여 중복 제거 후 오름차순 정렬
- [x] 각 목록은 실시간으로 구글시트에서 조회하여 최신 데이터 반영
- [x] 캐싱을 통해 API 호출 최소화

### 2.4 성능 최적화

#### 구현 상태: ✅ 부분 완료

- [x] 캐싱 전략:
  - [x] 예상퀵비 조회: 5분 TTL
  - [x] 업체명/전화번호/비용 목록: 10분 TTL
  - [x] 통계 데이터: 30분 TTL
- [ ] 배치 처리: 여러 매장간 조회를 한 번에 처리
- [ ] 페이지네이션: 업체 목록이 많을 경우 페이지네이션 적용 (기본 20개씩 표시)

---

## 3. 구글시트 구조

#### 구현 상태: ✅ 완료

- [x] 시트명: 퀵비용관리
- [x] 헤더 (A~AL열) - 복사 붙여넣기용:

```
등록일시	등록자매장명	등록자매장ID	출발매장명	출발매장ID	도착매장명	도착매장ID	모드타입	퀵서비스업체명1	퀵서비스업체전화번호1	퀵서비스업체비용1	퀵서비스업체배차속도1	퀵서비스업체픽업속도1	퀵서비스업체도착속도1	퀵서비스업체명2	퀵서비스업체전화번호2	퀵서비스업체비용2	퀵서비스업체배차속도2	퀵서비스업체픽업속도2	퀵서비스업체도착속도2	퀵서비스업체명3	퀵서비스업체전화번호3	퀵서비스업체비용3	퀵서비스업체배차속도3	퀵서비스업체픽업속도3	퀵서비스업체도착속도3	퀵서비스업체명4	퀵서비스업체전화번호4	퀵서비스업체비용4	퀵서비스업체배차속도4	퀵서비스업체픽업속도4	퀵서비스업체도착속도4	퀵서비스업체명5	퀵서비스업체전화번호5	퀵서비스업체비용5	퀵서비스업체배차속도5	퀵서비스업체픽업속도5	퀵서비스업체도착속도5
```

---

## 4. 모드 설정 추가

### 4.1 modeConfig.js 수정

#### 구현 상태: ✅ 완료

- [x] 퀵서비스 관리 모드 추가:
  - [x] key: quickServiceManagement
  - [x] title: '퀵서비스 관리 모드'
  - [x] description: '퀵서비스 업체 데이터를 관리하고 통계를 분석합니다.'
  - [x] features:
    - [x] '업체별 통계 및 분석'
    - [x] '지역별 인기/우수 업체 순위'
    - [x] '데이터 품질 관리'
    - [x] '이상치 데이터 검토'
  - [x] color: '#9C27B0'
  - [x] icon: LocalShippingIcon (또는 적절한 아이콘)
  - [x] category: 'admin'
  - [x] sheetRefs:
    - [x] admin: '대리점아이디관리!AF열'
    - [x] updates: '어플업데이트!Y열'

### 4.2 appUpdateService.js 수정

#### 구현 상태: ❌ 미구현

- [ ] UPDATE_SHEET_COLUMNS에 QUICK_SERVICE_MANAGEMENT 추가 (24인덱스)
- [ ] MODE_COLUMN_MAP에 'quickServiceManagement' 매핑 추가

---

## 5. 구현 세부사항

### 5.1 예상퀵비 계산 알고리즘

#### 구현 상태: ✅ 완료

- [x] 출발매장ID와 도착매장ID가 일치하는 모든 행 조회
- [x] 각 업체별로 데이터 수집 (업체1~5)
- [x] 업체명 정규화하여 그룹화
- [x] 업체별 평균 비용 계산: (모든 비용 합) / (입력자 수)
- [x] 각 데이터가 평균 대비 20% 이상 차이나는지 확인
- [x] 이상치 제외한 평균 재계산 (선택사항)
- [x] 업체별 서비스 품질 정보 계산:
  - [x] 배차속도: 각 속도(빠름/중간/느림)별 선택 횟수 집계 후 최빈값 반환
  - [x] 픽업속도: 각 속도(빠름/중간/느림)별 선택 횟수 집계 후 최빈값 반환
  - [x] 도착속도: 각 속도(빠름/중간/느림)별 선택 횟수 집계 후 최빈값 반환
- [x] 가격 오름차순 정렬

### 5.2 가격 비교 표시

#### 구현 상태: ✅ 완료

- [x] 모든 업체를 가격 순으로 표시
- [x] 가장 저렴한 업체는 "1순위" 또는 별도 강조
- [x] 업체명, 전화번호, 예상비용, 입력 건수 표시
- [x] 서비스 품질 정보 표시:
  - [x] 배차속도: 아이콘 또는 색상으로 표시 (빠름: 초록색 ⚡, 중간: 노란색 ⏱️, 느림: 빨간색 🐌)
  - [x] 픽업속도: 아이콘 또는 색상으로 표시
  - [x] 도착속도: 아이콘 또는 색상으로 표시
- [x] 이상치가 있는 경우 해당 업체에 경고 아이콘 표시

### 5.3 데이터 기반 선택 시스템

#### 구현 상태: ✅ 완료

- [x] 업체명 선택:
  - [x] 기존 등록된 업체명 목록 조회
  - [x] 정규화된 업체명으로 유니크 목록 생성
  - [x] 드롭다운에서 선택하거나 "직접 입력" 선택 가능
  - [x] "직접 입력" 선택 시 텍스트 입력 필드로 전환
  - [x] 최근 사용 업체 우선 표시
  - [x] 즐겨찾기 업체 우선 표시
- [x] 대표번호 선택:
  - [x] 선택한 업체명의 기존 등록된 전화번호 목록 조회
  - [x] 전화번호 정규화 (하이픈 제거)하여 유니크 목록 생성
  - [x] 드롭다운에서 선택하거나 "직접 입력" 선택 가능
  - [x] 업체명이 변경되면 대표번호 목록 자동 갱신
  - [x] "직접 입력" 선택 시 텍스트 입력 필드로 전환
- [x] 비용 선택:
  - [x] 선택한 업체명+전화번호 조합의 기존 등록된 비용 목록 조회
  - [x] 비용 목록을 오름차순 정렬하여 표시
  - [x] 드롭다운에서 선택하거나 "직접 입력" 선택 가능
  - [x] 업체명 또는 전화번호가 변경되면 비용 목록 자동 갱신
  - [x] "직접 입력" 선택 시 숫자 입력 필드로 전환
- [x] 서비스 품질 평가:
  - [x] 배차속도: 라디오 버튼 또는 드롭다운으로 선택 (빠름/중간/느림) - 필수 입력
  - [x] 픽업속도: 라디오 버튼 또는 드롭다운으로 선택 (빠름/중간/느림) - 필수 입력
  - [x] 도착속도: 라디오 버튼 또는 드롭다운으로 선택 (빠름/중간/느림) - 필수 입력
  - [x] 각 속도는 사용자가 직접 평가하여 입력
- [x] 직접 입력 모드:
  - [x] 각 필드에서 "직접 입력" 선택 시 해당 입력 필드로 전환
  - [x] 입력한 값은 새로운 데이터로 저장되어 다음 사용자에게 선택 옵션으로 제공
  - [x] 이를 통해 데이터 정규화가 자연스럽게 이루어짐

### 5.4 지역별 인기/우수 업체 순위

#### 구현 상태: ✅ 백엔드 완료, ❌ 프론트엔드 미구현

- [x] 지역 구분: 매장의 주소 기반으로 지역 분류 (시/도 단위)
- [x] 인기 업체 순위: 등록 건수 기준으로 정렬
- [x] 우수 업체 순위: 평균 속도 점수 기준으로 정렬
- [x] 속도 점수: 빠름=3점, 중간=2점, 느림=1점
- [x] 배차+픽업+도착 속도 점수의 평균
- [ ] 프론트엔드 UI 표시 (QuickServiceManagementMode에서 구현 필요)

---

## 6. 파일 변경 목록

### 신규 생성

- [x] `src/components/QuickCostModal.js`: 퀵비용 등록 모달
- [x] `src/components/EstimatedQuickCost.js`: 예상퀵비 표시 컴포넌트
- [x] `src/components/QuickCostPreview.js`: 지도 Popup용 퀵비용 미리보기
- [ ] `src/components/QuickServiceManagementMode.js`: 퀵서비스 관리 모드 컴포넌트
- [ ] `src/utils/quickCostService.js`: 퀵비용 관련 유틸리티 함수 (선택사항)

### 수정

- [x] `src/components/Map.js`: Popup에 예상퀵비 표시 추가, 매장 선택 시 Popup 자동 열기
- [x] `src/components/Map.js`: Popup에 "퀵비등록" 버튼 추가 (일반모드/관리자모드)
- [x] `src/components/QuickCostPreview.js`: 데이터 없을 때 등록 버튼 표시 기능 추가
- [x] `src/components/StoreInfoTable.js`: 매장간 퀵비용 예상 섹션 추가, 퀵비용 등록 버튼 추가
- [x] `src/api.js`: 퀵비용 관련 API 함수 추가
- [x] `src/config/modeConfig.js`: 퀵서비스 관리 모드 추가
- [ ] `src/utils/appUpdateService.js`: 퀵서비스 관리 모드 업데이트 컬럼 추가
- [ ] `src/App.js`: QuickServiceManagementMode 컴포넌트 통합
- [x] `server/index.js`: 퀵비용 API 엔드포인트 추가

---

## 7. 테스트 시나리오

### 시나리오 1: 매장 선택 시 Popup 자동 열기 및 퀵비용 정보 업데이트 ✅ (완료)

- [x] 일반모드에서 매장 마커 클릭 → 예상퀵비 표시 확인
- [x] 매장 선택 시 지도에서 해당 마커의 Popup 자동 열기
- [x] 매장 변경 시 퀵비용 정보 업데이트 확인
- [x] 관리자모드에서 동일 기능 동작 확인
- [x] 중복 좌표 케이스에서도 동일하게 동작 확인
- [x] 퀵비용이 없을 때 "등록된 퀵비용이 없습니다" 안내 메시지 및 등록 버튼 표시 확인

### 시나리오 2: 퀵비용 등록 기능 테스트

- [ ] 일반모드에서 매장 마커 클릭 → 예상퀵비 표시 확인
- [ ] 퀵비등록 버튼 클릭 → 모달 열림 확인
- [ ] 업체명 드롭다운에서 선택 → 대표번호 목록 자동 갱신 확인
- [ ] 대표번호 드롭다운에서 선택 → 비용 목록 자동 갱신 확인
- [ ] 배차/픽업/도착 속도 선택 → 필수 입력 확인
- [ ] 입력값 검증 확인 (비용 음수, 전화번호 형식 등)
- [ ] "직접 입력" 선택 → 입력 필드로 전환 확인
- [ ] 업체 정보 입력 및 저장 → 구글시트 저장 확인
- [ ] 여러 사용자가 동일 구간에 데이터 입력 → 평균 계산 확인
- [ ] 서비스 품질 정보 표시 확인 (배차/픽업/도착 속도)
- [ ] 이상치 데이터 입력 → 경고 표시 확인
- [ ] 관리자모드에서 동일 기능 동작 확인

### 시나리오 3: 예상퀵비 표시 기능 테스트

- [ ] 가격 비교 표시 확인 (가장 저렴한 업체 1순위)
- [ ] 모든 업체 가격 비교 표시 확인
- [ ] 검색 및 필터링 기능 확인
- [ ] 최근 사용 업체 기능 확인
- [ ] 즐겨찾기 업체 기능 확인

### 시나리오 4: 퀵서비스 관리 모드 테스트

- [ ] 퀵서비스 관리 모드 접근 권한 확인
- [ ] 퀵서비스 관리 모드에서 통계 확인
- [ ] 지역별 인기/우수 업체 순위 확인
- [ ] 데이터 품질 관리 기능 확인

### 시나리오 5: 성능 및 에러 처리 테스트

- [ ] 캐싱 동작 확인
- [ ] 에러 처리 확인 (네트워크 에러, API 에러 등)

---

## 8. 구현 진행 상황 요약

### 전체 진행률: 약 75% 완료

#### 완료된 주요 항목
- ✅ 퀵비용 등록 모달 (QuickCostModal.js)
- ✅ 예상퀵비 표시 컴포넌트 (EstimatedQuickCost.js)
- ✅ 지도 Popup 퀵비용 미리보기 (QuickCostPreview.js)
- ✅ StoreInfoTable 퀵비용 섹션
- ✅ Map.js Popup에 퀵비용 표시 및 자동 열기
- ✅ 백엔드 API 대부분 (save, estimate, companies, phone-numbers, costs, history, statistics, quality, normalize)
- ✅ modeConfig.js 퀵서비스 관리 모드 추가

#### 미구현 주요 항목
- ❌ QuickServiceManagementMode.js 컴포넌트 생성
- ❌ App.js에 QuickServiceManagementMode 통합
- ❌ updateQuickCost, deleteQuickCost API 함수 및 엔드포인트
- ❌ appUpdateService.js 수정

---

## 9. 최근 수정 내역

### 2024년 최근 수정 (현재 세션 - 진행 중)

> **참고**: 이 섹션은 코드 수정 중 실시간으로 업데이트됩니다. 커밋 정보는 실제 커밋할 때만 추가됩니다.

#### 작업 배경
- 테스트 시나리오 1번 진행 중 "퀵비용 조회 중..." 문구가 잠깐 보이다가 사라지는 문제 발견
- 퀵비용이 등록되지 않았을 때 안내 메시지와 등록 버튼이 필요함
- 플랜 파일의 1.1 Map.js 수정 항목 확인 중
- 테스트 결과: "등록된 퀵비용이 없습니다" 문구는 확인되었으나, Popup 하단의 퀵비등록 버튼이 보이지 않음

#### 수정 사항
1. **QuickCostPreview 컴포넌트 개선**
   - `onQuickCostClick` prop 추가
   - 퀵비용 데이터가 없을 때 안내 메시지와 함께 등록 버튼 표시
   - "등록된 퀵비용이 없습니다" 메시지와 "퀵비등록" 버튼 제공
   - 로딩 상태에서 "퀵비용 조회 중..." 표시 후, 데이터 없을 때 안내 메시지 지속 표시

2. **Map.js Popup 퀵비등록 버튼 추가 완료**
   - 일반모드: 주소 아래, 재고 위에 퀵비등록 버튼 추가 (이미 구현되어 있었음)
   - 관리자모드: 매장명 아래, 모델명/색상 정보 위에 퀵비등록 버튼 추가 (이미 구현되어 있었음)
   - QuickCostPreview에 `onQuickCostClick` prop 전달 (모든 위치에 추가)
   - 중복 좌표 케이스에도 동일하게 적용
   - 총 5곳의 QuickCostPreview 컴포넌트에 prop 전달 완료

#### 수정된 파일 상세
- `src/components/QuickCostPreview.js`
  - `onQuickCostClick` prop 추가 (line 7)
  - 데이터 없을 때 등록 버튼 표시 로직 추가 (line 43-87)
  - 버튼 스타일: 주황색 배경 (#ff9800), 흰색 텍스트
  - 버튼 클릭 시 fromStore, toStore 객체 생성하여 onQuickCostClick 호출

- `src/components/Map.js`
  - 모든 QuickCostPreview 컴포넌트에 `onQuickCostClick={onQuickCostClick}` prop 전달
  - 일반모드: 2곳 (중복 좌표 케이스, 단일 매장 케이스)
  - 관리자모드: 2곳 (중복 좌표 케이스, 단일 매장 케이스)
  - 중복 좌표 그룹 표시 케이스: 1곳
  - 총 5곳 모두 업데이트 완료

#### 커밋 정보
- **커밋 해시**: `226180b`
- **커밋 메시지**: "퀵비용 미리보기 컴포넌트에 등록 버튼 추가 및 Map.js에 prop 전달"
- **변경 파일**: 
  - `src/components/Map.js` (수정)
  - `src/components/QuickCostPreview.js` (수정)
- **변경 통계**: 2 files changed, 187 insertions(+), 33 deletions(-)

#### 테스트 상태
- ✅ 시나리오 1: 매장 선택 시 Popup 자동 열기 및 퀵비용 정보 업데이트 (구현 완료, 테스트 진행 중)
  - [x] 일반모드에서 매장 마커 클릭 → 예상퀵비 표시 확인
  - [x] 매장 선택 시 지도에서 해당 마커의 Popup 자동 열기
  - [x] 매장 변경 시 퀵비용 정보 업데이트 확인
  - [x] 관리자모드에서 동일 기능 동작 확인
  - [x] 중복 좌표 케이스에서도 동일하게 동작 확인
  - [x] 퀵비용이 없을 때 "등록된 퀵비용이 없습니다" 안내 메시지 및 등록 버튼 표시 확인
- ⏳ 시나리오 2: 퀵비용 등록 기능 테스트 (진행 예정)

#### 최근 수정 (테스트 피드백 반영)
1. **Popup 하단 퀵비등록 버튼 표시 조건 완화 (1차)**
   - 기존: `loggedInStore && loggedInStore.id && store.id && onQuickCostClick` (일반모드)
   - 기존: `requestedStore && requestedStore.id && store.id && onQuickCostClick` (관리자모드)
   - 1차 수정: `onQuickCostClick && store.id` 조건으로 완화
   - 결과: 여전히 버튼이 보이지 않음

2. **Popup 하단 퀵비등록 버튼 표시 조건 완화 (2차)**
   - 2차 수정: `onQuickCostClick ? (버튼) : null` 조건으로 단순화
   - `store.id` 조건 제거하여 `onQuickCostClick`만 있으면 버튼 항상 표시
   - 결과: 여전히 버튼이 보이지 않음

3. **Popup 하단 퀵비등록 버튼 표시 조건 완화 (3차)**
   - 3차 수정: 조건문 완전 제거, 버튼을 항상 렌더링
   - `onQuickCostClick ? (버튼) : null` → `<button>` (항상 렌더링)
   - 내부에서 `onQuickCostClick` 존재 여부 확인하여 클릭 처리
   - `disabled` 속성으로 비활성화 상태 관리
   - `loggedInStore`/`requestedStore`가 없으면 버튼 비활성화 (회색 배경, opacity 0.6)
   - 있으면 활성화 (파란색 배경, 클릭 가능)

2. **버튼 동작 개선**
   - 일반모드: `loggedInStore`가 있을 때만 클릭 가능
   - 관리자모드: `requestedStore`가 있을 때만 클릭 가능
   - 조건 불충족 시 `disabled` 속성으로 비활성화

#### 수정된 파일 (최근)
- `src/components/Map.js`
  - 일반모드: Popup 하단 퀵비등록 버튼 활성화 조건 추가 완화 (2곳)
    - `loggedInStore` 조건 제거
    - `onQuickCostClick`과 `store`만 있으면 활성화
    - 클릭 시 디버깅 로그 추가
  - 관리자모드: Popup 하단 퀵비등록 버튼 활성화 조건 추가 완화 (2곳)
    - `requestedStore` 조건 제거
    - `onQuickCostClick`과 `store`만 있으면 활성화
    - 클릭 시 디버깅 로그 추가
  - 활성화 조건: `disabled={!onQuickCostClick || !store}`
  - 버튼 비활성화 상태 스타일 유지

#### 커밋 정보 (최근)
- **커밋 해시**: `f88e8bf`
- **커밋 메시지**: "Map 컴포넌트에 onQuickCostClick prop 전달 확인을 위한 디버깅 로그 추가"
- **변경 파일**: 
  - `src/components/Map.js` (수정)
- **변경 통계**: 1 file changed, 19 insertions(+)
- **푸시 완료**: ✅ 자동 재배포 대기 중
- **이전 커밋**: `93de0ec` (디버깅 로그 강화), `3e141f7` (활성화 조건 추가 완화), `8b73410` (활성화 조건 완화), `a5f47cd` (버튼 항상 렌더링), `dcacfff` (2차 수정), `5cbef1f` (1차 수정)

#### 테스트 결과 (최근)
- ✅ 일반모드: 퀵비등록 버튼 표시 확인됨
- ✅ 관리자모드: 퀵비등록 버튼 표시 확인됨
- ❌ 일반모드: 버튼이 비활성화 상태 (여전히)
- ❌ 관리자모드: 버튼이 비활성화 상태 (여전히)
- 문제: 조건 완화 후에도 여전히 비활성화됨

#### 버튼 비활성화 원인 분석 및 해결
**일반모드 비활성화 조건 (기존):**
- `disabled={!onQuickCostClick || !loggedInStore || !loggedInStore.id || !store || !store.id}`
- 문제: `loggedInStore.id`와 `store.id` 체크가 불필요하게 엄격함
- 해결: 일반모드는 접속자 매장(`loggedInStore`)과 선택한 매장(`store`)만 있으면 활성화
- 수정 후: `disabled={!onQuickCostClick || !loggedInStore || !store}`

**관리자모드 비활성화 조건 (기존):**
- `disabled={!onQuickCostClick || !requestedStore || !requestedStore.id || !store || !store.id}`
- 문제: `requestedStore.id`와 `store.id` 체크가 불필요하게 엄격함
- 해결: 관리자모드는 재고요청점(`requestedStore`)과 선택한 매장(`store`)만 있으면 활성화
- 수정 후: `disabled={!onQuickCostClick || !requestedStore || !store}`

**요구사항:**
- 일반모드: 접속자 매장과 선택한 매장 사이의 퀵비용 등록이므로 특별한 조건 없이 활성화
- 관리자모드: 재고요청점과 선택한 매장 사이의 퀵비용 등록이므로 재고요청점이 선택되어 있으면 활성화
- 기억 기능처럼 단말기/색상 정보가 필요 없음

**추가 수정 (4차):**
- 일반모드: `loggedInStore` 조건 제거, `onQuickCostClick`과 `store`만 있으면 활성화
- 관리자모드: `requestedStore` 조건 제거, `onQuickCostClick`과 `store`만 있으면 활성화
- 클릭 시 디버깅 로그 추가 (조건 불충족 시 콘솔에 출력)
- 활성화 조건: `disabled={!onQuickCostClick || !store}`

**추가 수정 (5차 - 디버깅 강화):**
- 버튼 렌더링 시점에 비활성화 상태일 때 상세 디버깅 로그 추가
- `store`, `loggedInStore`, `requestedStore` 객체의 실제 값 확인 가능
- 비활성화 원인 파악을 위한 로그 추가

**문제 발견 (테스트 결과):**
- 콘솔 로그: `onQuickCostClick: false` 확인됨
- 원인: `onQuickCostClick` prop이 Map 컴포넌트에 전달되지 않음
- `store: true`, `loggedInStore: true`는 정상
- App.js 확인 결과: 두 곳에서 Map 컴포넌트 사용, 둘 다 `onQuickCostClick` 전달 중
- 가능한 원인: 빌드 캐시 문제 또는 조건부 렌더링

**추가 수정 (6차 - prop 전달 확인):**
- Map 컴포넌트에 useEffect로 `onQuickCostClick` prop 전달 여부 확인 로그 추가
- 전달되지 않을 경우 경고 로그 출력
- 전달될 경우 확인 로그 출력
- 비활성화 원인 파악을 위한 디버깅 강화

**추가 수정 (7차 - prop 상세 디버깅):**
- Map 컴포넌트에 더 상세한 디버깅 로그 추가
- `onQuickCostClick`의 실제 값, 타입, 함수 여부 등을 모두 확인
- `undefined`, `null`, 함수 등 모든 경우에 대한 로그 출력
- 커밋: cebd2ad - "Map 컴포넌트 onQuickCostClick prop 디버깅 로그 개선"
- 수정 파일: `src/components/Map.js`
  - useEffect 내부에 상세 디버깅 로그 추가
  - `onQuickCostClick`의 실제 값, 타입, `undefined`/`null`/함수 여부 모두 확인
  - 각 경우에 맞는 경고/확인 로그 출력

**추가 수정 (8차 - 퀵비등록 버튼 위치 정리):**
- Map.js의 Popup 하단에 있던 퀵비등록 버튼 제거 (4곳 모두)
- QuickCostPreview 컴포넌트 내부의 "등록된 퀵비용이 없습니다" 박스 안 버튼만 유지
- 관리자모드/일반모드, 단일매장/중복좌표 모든 케이스에서 하단 버튼 제거
- 커밋: 4e98329 - "Map.js Popup 하단 퀵비등록 버튼 제거 - QuickCostPreview 내부 버튼만 유지"
- 수정 파일: `src/components/Map.js`
  - 관리자모드 단일매장: 퀵비등록 버튼 제거
  - 일반모드 단일매장: 퀵비등록 버튼 제거
  - 관리자모드 중복좌표: 퀵비등록 버튼 제거
  - 일반모드 중복좌표: 퀵비등록 버튼 제거

#### 현재 상태 (2024년 현재 세션)
- **커밋**: 4e98329
- **작업 내용**: Map.js Popup 하단 퀵비등록 버튼 제거 - QuickCostPreview 내부 버튼만 유지
- **수정 파일**: 
  - `src/components/Map.js` (Popup 하단 퀵비등록 버튼 제거, 4곳 모두)
- **푸시 완료**: ✅
- **재배포 대기 중**: 재배포 완료 후 테스트 필요

#### 조건 복원 확인
- ✅ **QuickCostPreview 컴포넌트 렌더링 조건**: 원래대로 유지됨
  - 관리자모드: `requestedStore && requestedStore.id && store.id`
  - 일반모드: `loggedInStore && loggedInStore.id && store.id`
- ✅ **QuickCostPreview 내부 버튼 조건**: `onQuickCostClick`만 있으면 표시
- ✅ **완화했던 조건**: Popup 하단 버튼 제거로 자연스럽게 원래 조건으로 복원됨

#### 작동 시나리오 정리
**일반 모드:**
1. 로그인한 매장(`loggedInStore`)이 있고, 지도에서 다른 매장 선택
2. QuickCostPreview 표시 조건: `loggedInStore && loggedInStore.id && store.id` 모두 true
3. 퀵비용 데이터 조회: API 호출 (`fromStoreId={loggedInStore.id}`, `toStoreId={store.id}`)
4. 데이터 있음: 파란색 박스에 "예상 퀵비용" 표시 (1순위 업체 정보)
5. 데이터 없음: 주황색 박스에 "등록된 퀵비용이 없습니다" + "퀵비등록" 버튼 표시
6. 버튼 클릭: QuickCostModal 열림 (`fromStore: loggedInStore`, `toStore: 선택한 매장`)

**관리자 모드:**
1. 재고요청점(`requestedStore`)이 선택되어 있고, 지도에서 다른 매장 선택
2. QuickCostPreview 표시 조건: `requestedStore && requestedStore.id && store.id` 모두 true
3. 퀵비용 데이터 조회: API 호출 (`fromStoreId={requestedStore.id}`, `toStoreId={store.id}`)
4. 데이터 있음: 파란색 박스에 "예상 퀵비용" 표시 (1순위 업체 정보)
5. 데이터 없음: 주황색 박스에 "등록된 퀵비용이 없습니다" + "퀵비등록" 버튼 표시
6. 버튼 클릭: QuickCostModal 열림 (`fromStore: requestedStore`, `toStore: 선택한 매장`)

**버튼이 표시되지 않는 경우:**
- 일반모드: `loggedInStore` 없음 또는 `loggedInStore.id` 없음 또는 `store.id` 없음
- 관리자모드: `requestedStore` 없음 또는 `requestedStore.id` 없음 또는 `store.id` 없음
- 공통: `onQuickCostClick` prop이 전달되지 않음

#### 테스트 진행 상황
- ✅ **시나리오 1번 완료**: 매장 선택 시 Popup 자동 열기 및 퀵비용 정보 업데이트
  - 일반모드/관리자모드 모두 퀵비등록 버튼 정상 표시 확인됨
- ⏳ **시나리오 2번 진행 중**: 퀵비용 등록 기능 테스트

#### 다음 테스트 단계 (시나리오 2번)
**1단계: 모달 열기 및 기본 UI 확인** ✅ 완료
- [x] 퀵비등록 버튼 클릭 → QuickCostModal이 정상적으로 열리는지 확인
- [x] 모달 상단에 매장명이 올바르게 표시되는지 확인
  - 일반모드: "나의 매장 <-> 선택된 매장"
  - 관리자모드: "재고요청점 검색된 매장 <-> 선택된 매장"
- [x] 모달 내부에 입력 폼이 보이는지 확인

**2단계: 업체명 드롭다운 테스트** ⏳ 진행 중
- [x] 업체명 드롭다운 클릭 → 기존 등록된 업체명 목록이 표시되는지 확인 (정상, 등록된 업체명 없어서 "직접 입력"만 표시)
- [ ] 업체명 선택 → 대표번호 드롭다운이 자동으로 갱신되는지 확인 (업체명이 없어서 확인 불가)
- [x] "직접 입력" 선택 → 텍스트 입력 필드로 전환되는지 확인 (문제 발견: 무반응, 콘솔 로그도 없음)
  - **수정 진행**: QuickCostModal.js에서 디버깅 로그 추가 완료
  - **추가 수정**: Select onChange 핸들러에 콘솔 로그 추가하여 문제 원인 파악 중
  - **양방향 자동 반영 기능 추가**: A↔B 저장 시 B↔A도 자동 저장되도록 수정 완료

**3단계: 대표번호 드롭다운 테스트**
- [ ] 대표번호 드롭다운 클릭 → 선택한 업체명의 전화번호 목록이 표시되는지 확인
- [ ] 대표번호 선택 → 비용 드롭다운이 자동으로 갱신되는지 확인
- [ ] "직접 입력" 선택 → 텍스트 입력 필드로 전환되는지 확인

**4단계: 비용 드롭다운 테스트**
- [ ] 비용 드롭다운 클릭 → 선택한 업체명+전화번호 조합의 비용 목록이 표시되는지 확인
- [ ] 비용 선택 → 선택한 값이 입력 필드에 반영되는지 확인
- [ ] "직접 입력" 선택 → 텍스트 입력 필드로 전환되는지 확인

**5단계: 속도 선택 테스트 (배차/픽업/도착)**
- [ ] 배차속도 라디오 버튼 선택 (빠름/중간/느림) → 선택이 정상적으로 되는지 확인
- [ ] 픽업속도 라디오 버튼 선택 → 선택이 정상적으로 되는지 확인
- [ ] 도착속도 라디오 버튼 선택 → 선택이 정상적으로 되는지 확인

**6단계: 입력값 검증 테스트**
- [ ] 비용에 음수 입력 → 에러 메시지 표시 확인
- [ ] 비용에 0 입력 → 에러 메시지 표시 확인
- [ ] 비용에 1,000,000원 초과 입력 → 에러 메시지 표시 확인
- [ ] 전화번호에 잘못된 형식 입력 → 에러 메시지 표시 확인
- [ ] 업체명에 특수문자 입력 → 에러 메시지 표시 확인

**7단계: 여러 업체 정보 추가 테스트**
- [ ] "다른 업체 정보 추가" 버튼 클릭 → 두 번째 업체 입력 폼이 추가되는지 확인
- [ ] 최대 5개까지 추가되는지 확인
- [ ] 5개 추가 후 "다른 업체 정보 추가" 버튼이 비활성화되는지 확인

**8단계: 저장 기능 테스트**
- [ ] 모든 필수 항목 입력 후 저장 버튼 클릭
- [ ] 저장 성공 메시지 확인
- [ ] 구글시트에 데이터가 올바르게 저장되었는지 확인
- [ ] 저장 후 모달이 닫히는지 확인
- [ ] 저장 후 QuickCostPreview가 자동으로 업데이트되는지 확인

**9단계: 여러 사용자 동일 구간 테스트**
- [ ] 다른 사용자(또는 다른 매장)로 동일 구간에 데이터 입력
- [ ] 예상퀵비에서 평균 계산이 올바르게 되는지 확인

---

### 2024년 최근 수정 (커밋: 65a59d9)

#### 수정 사항
1. **매장 선택 시 Popup 자동 열기 기능 추가**
   - `Map.js`의 `useEffect`에서 `selectedStore` 변경 감지
   - 지도에서 해당 위치의 마커를 찾아 Popup 자동으로 열기
   - 지도 이동 후 300ms 지연 후 Popup 열기 (지도 렌더링 대기)

2. **퀵비용 정보 업데이트 개선**
   - `QuickCostPreview` 컴포넌트에 `key` prop 추가
   - `key` 값: `quickcost-${fromStoreId}-${toStoreId}-${selectedStore?.id === store.id ? 'selected' : 'normal'}`
   - 매장 선택 상태 변경 시 컴포넌트 재렌더링 보장
   - 모든 Popup 위치에 동일하게 적용 (단일 매장, 중복 좌표 케이스)

3. **모드별 처리 개선**
   - 관리자 모드: `requestedStore`가 있을 때만 퀵비용 정보 표시
   - 일반 모드: `loggedInStore`가 있을 때만 퀵비용 정보 표시
   - 중복 좌표 케이스에도 동일한 로직 적용

#### 수정된 파일
- `src/components/Map.js`
  - `useEffect` 추가: 매장 선택 시 Popup 자동 열기
  - `QuickCostPreview`에 `key` prop 추가 (모든 위치)
  - 지도 마커 찾기 로직 추가 (`map.eachLayer` 사용)

#### 커밋 정보
- **커밋 해시**: `65a59d9`
- **커밋 메시지**: "매장 선택 시 Popup 자동 열기 및 퀵비용 정보 업데이트 기능 개선"
- **변경 파일**: 
  - `src/components/Map.js` (수정)
  - `src/components/QuickCostPreview.js` (신규 생성)

---

## 참고 사항

### 데이터 구조
- **퀵비용 데이터**: `퀵비용관리` 시트
  - 등록일시, 등록자매장명, 등록자매장ID, 출발매장명, 출발매장ID, 도착매장명, 도착매장ID, 모드타입
  - 퀵서비스업체명1~5, 퀵서비스업체전화번호1~5, 퀵서비스업체비용1~5
  - 퀵서비스업체배차속도1~5, 퀵서비스업체픽업속도1~5, 퀵서비스업체도착속도1~5

### 캐싱 전략
- 예상 퀵비용: 5분 캐싱
- 업체명 목록: 10분 캐싱
- 전화번호/비용 목록: 10분 캐싱
- 통계 데이터: 30분 캐싱
- 클라이언트 사이드 캐싱 사용 (`clientCacheUtils`)

### 모드별 동작
- **일반 모드**: `loggedInStore` → `selectedStore` 퀵비용 조회
- **관리자 모드**: `requestedStore` → `selectedStore` 퀵비용 조회

---

**마지막 업데이트**: 2024년 (현재 세션 - 커밋: 4e98329)  
**전체 진행률**: 약 75% 완료  
**다음 작업 우선순위**: 재배포 완료 후 테스트 (퀵비등록 버튼 위치 확인) → QuickCostPreview 내부 버튼 동작 확인 → 시나리오 1번 재테스트 → 시나리오 2번 진행 → QuickServiceManagementMode 컴포넌트 생성

---

## 📌 다음 스레드에서 이어가기

**간단 버전:**
```
매장간 퀵비용 기능 구현 중입니다.
플랜 파일: 매장간_퀵비용_예상_기능_구현_플랜_완전판.md
최근 커밋 226180b 완료, 테스트 시나리오 1번 진행 중입니다.
[테스트 결과 또는 다음 작업 요청]
```

**상세 버전:**
```
매장간 퀵비용 예상 기능 구현을 진행 중입니다.

1. 플랜 파일: 매장간_퀵비용_예상_기능_구현_플랜_완전판.md (로컬 프로젝트 폴더)

2. 최근 완료 작업 (커밋 226180b):
   - QuickCostPreview.js: 데이터 없을 때 등록 버튼 추가
   - Map.js: QuickCostPreview에 onQuickCostClick prop 전달 (5곳 모두)

3. 현재 상태:
   - 시나리오 1번 테스트 진행 중
   - 플랜 파일에 진행 상황 계속 업데이트 필요

4. 다음 작업:
   [테스트 결과에 따라 또는 원하는 작업 명시]
```

**핵심 키워드:**
- 플랜 파일: `매장간_퀵비용_예상_기능_구현_플랜_완전판.md`
- 최근 커밋: `4e98329`
- 현재 단계: 재배포 완료 후 테스트 (퀵비등록 버튼 위치 확인)
- 완료: `onQuickCostClick` prop 정상 전달 확인, Popup 하단 퀵비등록 버튼 제거 완료

**작업 규칙:**
- 코드 수정 완료 시 항상 커밋 및 푸시 (자동 재배포를 위해 필수)
- 플랜 파일은 커밋하지 않음 (로컬에서만 관리)
- **중요**: 코드 수정 시 항상 플랜 파일도 함께 업데이트 (대화가 끊길 것을 대비)
  - **코드 수정하는 즉시 플랜 파일도 함께 업데이트** (커밋 전에!)
  - 수정한 파일 목록 기록
  - 수정 내용 요약 기록
  - 현재 상태 및 다음 작업 예정 기록
  - 커밋 후에는 커밋 해시 및 메시지만 추가 기록

---

## 10. 작업 규칙

### 10.1 코드 수정 완료 시 자동 커밋 및 푸시

#### 규칙
- **모든 코드 수정이 완료되면 반드시 깃에 커밋하고 푸시해야 함**
- 플랜 파일은 커밋하지 않음 (로컬에서만 관리)
- 자동 재배포를 위해 푸시 필수

#### 커밋 절차
1. 코드 수정 완료 후 `git status`로 변경 파일 확인
2. 플랜 파일을 제외한 수정된 파일만 `git add`로 스테이징
3. 의미 있는 커밋 메시지 작성 후 커밋
4. `git push origin main`으로 푸시

#### 커밋 메시지 작성 가이드
- 간결하고 명확하게 작성
- 주요 변경 사항 요약
- 테스트 피드백 반영 시 명시

#### 예시
```bash
# 변경 파일 확인
git status

# 플랜 파일 제외하고 스테이징
git add src/components/Map.js src/components/QuickCostPreview.js

# 커밋
git commit -m "Popup 하단 퀵비등록 버튼 표시 조건 완화
- 일반모드/관리자모드 모두 버튼 항상 표시되도록 조건 완화
- 테스트 피드백 반영"

# 푸시
git push origin main
```

#### 주의사항
- 플랜 파일(`매장간_퀵비용_예상_기능_구현_플랜_완전판.md`)은 절대 커밋하지 않음
- 커밋 후 플랜 파일에 커밋 정보 업데이트
- 푸시 완료 후 자동 재배포 대기 시간 고려

### 10.2 플랜 파일 업데이트 규칙

#### 업데이트 시점
- **코드 수정 시작 시**: 작업 배경 및 계획 기록
- **코드 수정 중**: 수정 사항 및 변경 내용 실시간 기록
- **코드 수정 완료 시**: 수정된 파일 상세 및 변경 내용 최종 정리
- **테스트 결과 확인 시**: 테스트 상태 업데이트
- **커밋 완료 시**: 커밋 정보만 추가 (최근 커밋 섹션)

#### 업데이트 내용
- **코드 수정 중**: "9. 최근 수정 내역" 섹션의 "현재 세션" 부분에 실시간 기록
  - 작업 배경
  - 수정 사항 (진행 중)
  - 수정된 파일 상세 (진행 중)
  - 테스트 상태
- **커밋 시**: 커밋 정보만 추가
  - 커밋 해시
  - 커밋 메시지
  - 변경 통계
  - 푸시 완료 여부

#### 중요 규칙
- **코드 수정과 플랜 파일 수정은 동시에 진행**
- 코드 수정 중 대화가 끊어져도 플랜 파일에 진행 상황이 기록되어 있어야 함
- 커밋 정보는 커밋할 때만 업데이트 (코드 수정 중에는 업데이트하지 않음)
- 플랜 파일의 "최근 커밋" 정보는 실제 커밋 후에만 업데이트
